<!DOCTYPE html>
<html lang="zh-TW" class="dark" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å®šæœŸè©•é‡å¯¦æ™‚ç‹€æ…‹æ­ç¤ºæ¿</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script> tailwind.config = { darkMode: 'class' };</script>
  <style>
    /* === v1.0.1 æ–°å¢/èª¿æ•´æ¨£å¼å€ === */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    :root{
      --bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--ring:#22d3ee;
      --accent:#38bdf8;--accent-2:#a78bfa;--good:#34d399;--warn:#fbbf24;--bad:#f87171;
    }
    
    /* === ä¸»é¡Œé…ç½® === */
    /* æš—è‰²ä¸»é¡Œï¼ˆé è¨­ï¼‰ */
    [data-theme="dark"] {
      --bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--ring:#22d3ee;
      --accent:#38bdf8;--accent-2:#a78bfa;--good:#34d399;--warn:#fbbf24;--bad:#f87171;
    }
    
    /* é»‘æ¿ä¸»é¡Œ */
    [data-theme="blackboard"] {
      --bg:#2d5016;--panel:#1a3009;--muted:#9faf7f;--text:#f5f5dc;--ring:#ffd700;
      --accent:#ffd700;--accent-2:#ffeb3b;--good:#90ee90;--warn:#ffa500;--bad:#ff6b6b;
    }
    
    /* æ·ºè‰²ä¸»é¡Œ */
    [data-theme="light"] {
      --bg:#f5f5f5;--panel:#ffffff;--muted:#374151;--text:#111827;--ring:#3b82f6;
      --accent:#2563eb;--accent-2:#7c3aed;--good:#059669;--warn:#d97706;--bad:#dc2626;
    }
    
    /* æ·ºè‰²ä¸»é¡Œ 2ï¼ˆæ«»èŠ±ç²‰è‰²ç³»ï¼‰ */
    [data-theme="light-soft"] {
      --bg:#fef1f2;--panel:#fff5f7;--muted:#7f1d1d;--text:#1f0a0a;--ring:#ec4899;
      --accent:#ec4899;--accent-2:#db2777;--good:#059669;--warn:#d97706;--bad:#dc2626;
    }
    
    /* è—è‰²ä¸»é¡Œ */
    [data-theme="blue"] {
      --bg:#0f172a;--panel:#1e293b;--muted:#94a3b8;--text:#e2e8f0;--ring:#60a5fa;
      --accent:#60a5fa;--accent-2:#818cf8;--good:#34d399;--warn:#fbbf24;--bad:#f87171;
    }
    
    /* ç´«è‰²ä¸»é¡Œ */
    [data-theme="purple"] {
      --bg:#1a0b2e;--panel:#2d1b3d;--muted:#a78bfa;--text:#e9d5ff;--ring:#c084fc;
      --accent:#c084fc;--accent-2:#a78bfa;--good:#34d399;--warn:#fbbf24;--bad:#f87171;
    }
    
    /* æš–è‰²ä¸»é¡Œ */
    [data-theme="warm"] {
      --bg:#2d1b0e;--panel:#3d2817;--muted:#d4a574;--text:#f5e6d3;--ring:#f59e0b;
      --accent:#f59e0b;--accent-2:#f97316;--good:#34d399;--warn:#fbbf24;--bad:#f87171;
    }
    
    /* é«˜å°æ¯”ä¸»é¡Œ */
    [data-theme="high-contrast"] {
      --bg:#000000;--panel:#1a1a1a;--muted:#808080;--text:#ffffff;--ring:#00ffff;
      --accent:#00ffff;--accent-2:#ffff00;--good:#00ff00;--warn:#ffaa00;--bad:#ff0000;
    }
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans TC',sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden}
    
    /* === æ·ºè‰²ä¸»é¡Œæ–‡å­—å°æ¯”åº¦å„ªåŒ– === */
    [data-theme="light"] .text-slate-300,
    [data-theme="light"] .text-slate-400,
    [data-theme="light-soft"] .text-slate-300,
    [data-theme="light-soft"] .text-slate-400 {
      color: var(--muted) !important;
    }
    [data-theme="light"] .text-slate-200,
    [data-theme="light"] .text-slate-100,
    [data-theme="light-soft"] .text-slate-200,
    [data-theme="light-soft"] .text-slate-100 {
      color: var(--text) !important;
    }
    [data-theme="light"] .text-slate-500,
    [data-theme="light-soft"] .text-slate-500 {
      color: var(--muted) !important;
    }
    /* æ·ºè‰²ä¸»é¡Œä¸‹çš„é‚Šæ¡†å’ŒèƒŒæ™¯èª¿æ•´ */
    [data-theme="light"] .border-slate-700,
    [data-theme="light"] .border-slate-800,
    [data-theme="light-soft"] .border-slate-700,
    [data-theme="light-soft"] .border-slate-800 {
      border-color: rgba(0,0,0,.15) !important;
    }
    [data-theme="light"] [class*="bg-slate-800"],
    [data-theme="light"] [class*="bg-slate-900"],
    [data-theme="light-soft"] [class*="bg-slate-800"],
    [data-theme="light-soft"] [class*="bg-slate-900"] {
      background: var(--panel) !important;
    }
    
    /* === æ·ºè‰²ä¸»é¡Œæ™‚é˜æ¨£å¼ === */
    [data-theme="light"] #pres-clock {
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.9)) !important;
      border: 3px solid rgba(37,99,235,.4) !important;
      color: #111827 !important;
      box-shadow:
        0 10px 35px rgba(0,0,0,.2),
        0 0 0 1px rgba(37,99,235,.2) inset,
        0 0 32px rgba(37,99,235,.15) !important;
    }
    [data-theme="light"] #pres-clock .clock-time {
      color: #2563eb !important;
      text-shadow: 0 2px 8px rgba(37,99,235,.3), 0 0 16px rgba(37,99,235,.2) !important;
    }
    [data-theme="light"] #pres-clock .clock-date {
      color: #374151 !important;
    }
    [data-theme="light"] #pres-clock .clock-badge {
      background: rgba(37,99,235,.15) !important;
      color: #2563eb !important;
      border-color: rgba(37,99,235,.3) !important;
    }
    
    /* === æ«»èŠ±ç²‰ä¸»é¡Œç‰¹æ®Šæ¨£å¼ === */
    [data-theme="light-soft"] #hero {
      background: linear-gradient(145deg, rgba(236,72,153,.25), rgba(219,39,119,.20)) !important;
      border: 2px solid rgba(236,72,153,.3) !important;
      box-shadow: 0 10px 40px rgba(236,72,153,.2), 0 0 20px rgba(236,72,153,.1) !important;
    }
    
    /* === æ«»èŠ±ç²‰ä¸»é¡Œæ™‚é˜æ¨£å¼ === */
    [data-theme="light-soft"] #pres-clock {
      background: linear-gradient(180deg, rgba(255,245,247,.95), rgba(254,241,242,.9)) !important;
      border: 3px solid rgba(236,72,153,.5) !important;
      color: #1f0a0a !important;
      box-shadow:
        0 10px 35px rgba(236,72,153,.25),
        0 0 0 1px rgba(236,72,153,.3) inset,
        0 0 32px rgba(236,72,153,.2) !important;
    }
    [data-theme="light-soft"] #pres-clock .clock-time {
      color: #ec4899 !important;
      text-shadow: 0 2px 8px rgba(236,72,153,.4), 0 0 16px rgba(236,72,153,.3) !important;
    }
    [data-theme="light-soft"] #pres-clock .clock-date {
      color: #7f1d1d !important;
    }
    [data-theme="light-soft"] #pres-clock .clock-badge {
      background: rgba(236,72,153,.2) !important;
      color: #ec4899 !important;
      border-color: rgba(236,72,153,.4) !important;
    }
    [data-theme="light-soft"] #hero h2 {
      color: var(--accent) !important;
      text-shadow: 0 2px 8px rgba(236,72,153,.2) !important;
    }
    [data-theme="light-soft"] #hero .rounded-2xl {
      background: rgba(255,245,247,.9) !important;
      border: 2px solid rgba(236,72,153,.4) !important;
      box-shadow: 0 4px 20px rgba(236,72,153,.15), inset 0 1px 0 rgba(255,255,255,.5) !important;
    }
    [data-theme="light-soft"] #current-subject {
      color: var(--accent) !important;
      text-shadow: 0 2px 12px rgba(236,72,153,.3) !important;
    }
    [data-theme="light-soft"] #subject-time-range {
      color: var(--accent-2) !important;
      font-weight: 600 !important;
    }
    
    /* === æ·ºè‰²ä¸»é¡Œæ™‚é˜æ¨£å¼ï¼ˆå…¨è¢å¹•å±•ç¤ºæ¨¡å¼ï¼‰ === */
    [data-theme="light"] #pres-clock {
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.9)) !important;
      border: 3px solid rgba(37,99,235,.4) !important;
      color: #111827 !important;
      box-shadow:
        0 10px 35px rgba(0,0,0,.2),
        0 0 0 1px rgba(37,99,235,.2) inset,
        0 0 32px rgba(37,99,235,.15) !important;
    }
    [data-theme="light"] #pres-clock .clock-time {
      color: #2563eb !important;
      text-shadow: 0 2px 8px rgba(37,99,235,.3), 0 0 16px rgba(37,99,235,.2) !important;
    }
    [data-theme="light"] #pres-clock .clock-date {
      color: #374151 !important;
    }
    [data-theme="light"] #pres-clock .clock-badge {
      background: rgba(37,99,235,.15) !important;
      color: #2563eb !important;
      border-color: rgba(37,99,235,.3) !important;
    }
    
    /* === æ«»èŠ±ç²‰ä¸»é¡Œæ™‚é˜æ¨£å¼ï¼ˆå…¨è¢å¹•å±•ç¤ºæ¨¡å¼ï¼‰ === */
    [data-theme="light-soft"] #pres-clock {
      background: linear-gradient(180deg, rgba(255,245,247,.95), rgba(254,241,242,.9)) !important;
      border: 3px solid rgba(236,72,153,.5) !important;
      color: #1f0a0a !important;
      box-shadow:
        0 10px 35px rgba(236,72,153,.25),
        0 0 0 1px rgba(236,72,153,.3) inset,
        0 0 32px rgba(236,72,153,.2) !important;
    }
    [data-theme="light-soft"] #pres-clock .clock-time {
      color: #ec4899 !important;
      text-shadow: 0 2px 8px rgba(236,72,153,.4), 0 0 16px rgba(236,72,153,.3) !important;
    }
    [data-theme="light-soft"] #pres-clock .clock-date {
      color: #7f1d1d !important;
    }
    [data-theme="light-soft"] #pres-clock .clock-badge {
      background: rgba(236,72,153,.2) !important;
      color: #ec4899 !important;
      border-color: rgba(236,72,153,.4) !important;
    }
    
    .main-container{max-width:90rem;height:100%;padding:1.25rem;margin:0 auto;display:flex;flex-direction:column;gap:1rem}
    textarea{min-height:80px;resize:vertical}
    .timeline-item{position:relative;padding-left:1rem;border-left:2px solid rgba(148,163,184,.25);margin-left:.25rem}
    .timeline-item.active{border-left-color:var(--bad);background:rgba(248,113,113,.08)}
    .timeline-indicator{position:absolute;left:-9px;top:50%;transform:translateY(-50%);width:14px;height:14px;background:var(--accent);border-radius:9999px;z-index:10;border:3px solid var(--panel)}
    .timeline-item.active .timeline-indicator{background:var(--bad);box-shadow:0 0 10px rgba(248,113,113,.6)}
    .schedule-list{overflow-y:auto;flex-grow:1}
    .glass{backdrop-filter:blur(6px);background:rgba(15,23,42,.6)}
    .card{background:var(--panel);border:1px solid rgba(148,163,184,.12)}
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:.5rem;font-weight:700;transition:background-color .15s ease,opacity .15s ease;padding:.25rem .75rem;font-size:.875rem}
    .btn-sky{background:#0ea5e9;color:#0b1220}.btn-sky:hover{background:#38bdf8}
    .btn-teal{background:#14b8a6;color:#052e2b}.btn-teal:hover{background:#2dd4bf}
    .btn-gray{background:#334155;color:#e2e8f0}.btn-gray:hover{background:#475569}
    .btn-rose{background:#f43f5e;color:#0b1220}.btn-rose:hover{background:#fb7185}
    .ring-focus{outline:none;box-shadow:0 0 0 3px rgba(34,211,238,.35)}
    .timeline-item[data-index][data-type="exam"] .text-sm,.timeline-item.exam .text-sm{font-size:1.125rem;font-weight:700;color:var(--accent)}
    .timeline-item.exam.active .text-sm{color:var(--bad)}
    #schedule-timeline .timeline-item.exam .text-sm,#schedule-timeline .timeline-item[data-type="exam"] .text-sm{font-size:1.125rem;font-weight:800}
    .modal{opacity:1}

    /* === ä¸‹æ‹‰é¸å–®æ¨£å¼ === */
    .dropdown-menu{
      position:relative;
    }
    .dropdown-content{
      position:absolute;
      top:calc(100% + 0.5rem);
      right:0;
      background:var(--panel);
      border:1px solid rgba(148,163,184,.2);
      border-radius:0.5rem;
      box-shadow:0 10px 25px rgba(0,0,0,.3);
      min-width:220px;
      z-index:1000;
      opacity:0;
      visibility:hidden;
      transform:translateY(-10px);
      transition:opacity 0.2s ease,transform 0.2s ease,visibility 0.2s;
      padding:0.5rem 0;
    }
    .dropdown-menu.active .dropdown-content{
      opacity:1;
      visibility:visible;
      transform:translateY(0);
    }
    .dropdown-item{
      display:flex;
      align-items:center;
      gap:0.5rem;
      padding:0.625rem 0.75rem;
      border-radius:0.375rem;
      cursor:pointer;
      transition:background-color 0.15s ease;
      font-size:0.875rem;
      color:var(--text);
    }
    .dropdown-item:hover{
      background:rgba(148,163,184,.1);
    }
    .dropdown-divider{
      height:1px;
      background:rgba(148,163,184,.2);
      margin:0.5rem 0;
    }
    .dropdown-toggle-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0.625rem 0.75rem;
      border-radius:0.375rem;
      cursor:pointer;
      transition:background-color 0.15s ease;
      font-size:0.875rem;
      color:var(--text);
      margin:0.25rem 0;
    }
    .dropdown-toggle-item:hover{
      background:rgba(148,163,184,.1);
    }
    .dropdown-toggle-item .toggle-label{
      width:100%;
      justify-content:space-between;
      margin:0;
      gap:1rem;
    }

    /* === æ»‘å‹•é–‹é—œæ¨£å¼ === */
    .toggle-switch{
      position:relative;
      display:inline-block;
      width:48px;
      height:24px;
    }
    .toggle-switch input{
      opacity:0;
      width:0;
      height:0;
    }
    .toggle-slider{
      position:absolute;
      cursor:pointer;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background-color:#475569;
      transition:0.3s;
      border-radius:24px;
    }
    .toggle-slider:before{
      position:absolute;
      content:"";
      height:18px;
      width:18px;
      left:3px;
      bottom:3px;
      background-color:white;
      transition:0.3s;
      border-radius:50%;
    }
    .toggle-switch input:checked + .toggle-slider{
      background-color:#0ea5e9;
    }
    .toggle-switch input:checked + .toggle-slider:before{
      transform:translateX(24px);
    }
    .toggle-label{
      display:flex;
      align-items:center;
      gap:0.75rem;
      font-size:0.875rem;
      color:var(--text);
    }

    /* === ä¸»é¡Œé¸æ“‡æŒ‰éˆ•æ¨£å¼ === */
    .theme-btn{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:0.25rem;
      padding:0.5rem;
      border-radius:0.5rem;
      border:2px solid rgba(148,163,184,.2);
      background:var(--panel);
      cursor:pointer;
      transition:all 0.2s ease;
      font-size:0.75rem;
      color:var(--text);
    }
    .theme-btn:hover{
      border-color:var(--accent);
      background:var(--panel);
      opacity:0.9;
      transform:translateY(-2px);
      box-shadow:0 2px 8px rgba(0,0,0,.2);
    }
    .theme-btn.active{
      border-color:var(--accent);
      background:var(--panel);
      box-shadow:0 0 0 2px var(--ring), 0 2px 8px rgba(0,0,0,.2);
      font-weight:600;
    }
    .theme-preview{
      width:100%;
      height:24px;
      border-radius:0.25rem;
      border:1px solid rgba(148,163,184,.3);
    }
    .theme-preview.dark-theme{
      background:linear-gradient(90deg, #0b1220 0%, #0f172a 50%, #38bdf8 100%);
    }
    .theme-preview.blackboard-theme{
      background:linear-gradient(90deg, #2d5016 0%, #1a3009 50%, #ffd700 100%);
    }
    .theme-preview.light-theme{
      background:linear-gradient(90deg, #f5f5f5 0%, #ffffff 50%, #2563eb 100%);
    }
    .theme-preview.light-soft-theme{
      background:linear-gradient(90deg, #fef1f2 0%, #fff5f7 50%, #ec4899 100%);
    }
    .theme-preview.blue-theme{
      background:linear-gradient(90deg, #0f172a 0%, #1e293b 50%, #60a5fa 100%);
    }
    .theme-preview.purple-theme{
      background:linear-gradient(90deg, #1a0b2e 0%, #2d1b3d 50%, #c084fc 100%);
    }
    .theme-preview.warm-theme{
      background:linear-gradient(90deg, #2d1b0e 0%, #3d2817 50%, #f59e0b 100%);
    }
    .theme-preview.high-contrast-theme{
      background:linear-gradient(90deg, #000000 0%, #1a1a1a 50%, #00ffff 100%);
    }

    /* === Tooltip æ¨£å¼ === */
    .tooltip-wrapper{
      position:relative;
      display:inline-block;
    }
    .tooltip{
      position:absolute;
      bottom:calc(100% + 0.5rem);
      left:50%;
      transform:translateX(-50%);
      background:rgba(15,23,42,.95);
      color:var(--text);
      padding:0.5rem 0.75rem;
      border-radius:0.375rem;
      font-size:0.75rem;
      white-space:nowrap;
      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transition:opacity 0.2s ease,visibility 0.2s;
      z-index:200;
      border:1px solid rgba(148,163,184,.2);
    }
    .tooltip-wrapper:hover .tooltip{
      opacity:1;
      visibility:visible;
    }
    .tooltip:after{
      content:"";
      position:absolute;
      top:100%;
      left:50%;
      transform:translateX(-50%);
      border:5px solid transparent;
      border-top-color:rgba(15,23,42,.95);
    }

    /* === åœ–ç¤ºæŒ‰éˆ•æ¨£å¼ === */
    .icon-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:2.5rem;
      height:2.5rem;
      border-radius:0.5rem;
      background:var(--panel);
      border:1px solid rgba(148,163,184,.2);
      color:var(--text);
      cursor:pointer;
      transition:all 0.15s ease;
      font-size:1.25rem;
    }
    .icon-btn:hover{
      background:rgba(148,163,184,.1);
      border-color:rgba(148,163,184,.3);
    }
    .icon-btn.active{
      background:#0ea5e9;
      color:#0b1220;
      border-color:#0ea5e9;
    }

    /* === å¤§æ™‚é˜ HUDï¼ˆåŸæ¨£å¼ï¼Œä¾›æœªé–å®šæ™‚ä½¿ç”¨ï¼‰ === */
    .clock-hud{
      position:fixed; z-index:55; user-select:none;
      background:rgba(2,6,23,.75);
      border:1px solid rgba(148,163,184,.25);
      backdrop-filter:blur(8px);
      box-shadow:0 8px 30px rgba(0,0,0,.35), 0 0 24px rgba(56,189,248,.18);
      border-radius:18px; padding:.5rem .75rem;
      display:flex; align-items:center; gap:.6rem;
      cursor:grab;
      transform: scale(var(--clock-scale, 2));
      transform-origin: top right;
    }
    .clock-hud.dragging{cursor:grabbing}
    .clock-time{font-weight:900; letter-spacing:.5px; text-shadow:0 0 12px rgba(56,189,248,.35);}
    .clock-date{font-size:.7rem;color:#cbd5e1}
    .clock-dot{animation:blink 1s steps(2,start) infinite}
    @keyframes blink{to{opacity:.2}}
    .clock-badge{font-size:.65rem; padding:.1rem .4rem; border-radius:9999px;background:rgba(56,189,248,.18); color:#bae6fd; border:1px solid rgba(56,189,248,.35)}
    .clock-actions button{font-size:.7rem; padding:.2rem .45rem; border-radius:.4rem;background:#0ea5e9; color:#06253a; font-weight:800;}
    .clock-actions button:hover{background:#38bdf8}
    .snap-tip{position:absolute; inset:auto auto -18px 0; font-size:.65rem; color:#94a3b8}
    #clock-hud{top:12px; right:16px}

    /* å±•ç¤ºæ¨¡å¼åŸæ¨£å¼ï¼ˆæœªé–å®šæ™‚ï¼‰ */
    #pres-clock{
      position:fixed; z-index:70; left:50%; transform:translateX(-50%) scale(var(--clock-scale, 2));
      top:70px; color:snow;
      cursor:default; user-select:none; padding:.75rem 1.25rem;
      border-radius:22px; backdrop-filter:blur(10px);
      background:linear-gradient(180deg, rgba(2,8,23,.75), rgba(2,8,23,.6));
      border:5px solid rgba(148,163,184,.25);
      box-shadow:
        0 10px 35px rgba(0,0,0,.45),
        0 0 0 1px rgba(56,189,248,.18) inset,
        0 0 32px rgba(56,189,248,.25);
    }
    @media (min-width: 768px){
      #clock-hud .clock-time{font-size:1.5rem}
      #pres-clock .clock-time{font-size:5rem}
    }
    @media (max-width: 767px){
      #clock-hud .clock-time{font-size:1.25rem}
      #pres-clock .clock-time{font-size:4rem}
    }

    /* === Clock é–å®šæ¨¡å¼ï¼šåµŒå…¥ï¼ˆé¿å…é®æ“‹ï¼‰ï¼Œä¸”éš±è—æ“ä½œéˆ• === */
    .clock-hud.docked {
      position: static !important;
      z-index: auto !important;
      transform: none !important;
      transform-origin: initial !important;
      background: transparent !important;
      border: 0 !important;
      box-shadow: none !important;
      padding: 0 !important;
      cursor: default !important;
      flex-shrink: 0;
      white-space: nowrap;
      display: flex !important;
      align-items: center !important;
    }
    #clock-hud-holder {
      display: flex;
      align-items: center;
      margin-left: auto;
    }
    /* ç¢ºä¿éš±è—æ™‚é˜æ™‚ï¼Œå®¹å™¨å’Œæ™‚é˜æœ¬èº«éƒ½å®Œå…¨éš±è— */
    #clock-hud-holder.hidden,
    #clock-hud.hidden,
    #pres-clock.hidden {
      display: none !important;
    }
    /* ç¢ºä¿éš±è—é€²åº¦æ¢æ™‚ï¼Œå®¹å™¨å®Œå…¨éš±è— */
    #subject-progress-container.hidden,
    #pres-progress-container.hidden {
      display: none !important;
    }

    /* === å…¨ç•«é¢å±•ç¤ºæ¨¡å¼ä¸»é¡Œæ¨£å¼ === */
    #presentation-overlay {
      background: var(--bg) !important;
      color: var(--text) !important;
    }
    #present-toolbar {
      background: var(--panel) !important;
      border-color: rgba(148,163,184,.2) !important;
    }
    /* å·¥å…·åˆ—æ–‡å­—é¡è‰² */
    #present-toolbar > div:first-child,
    #present-toolbar > div:first-child span {
      color: var(--muted) !important;
    }
    #presentation-overlay .text-slate-300 {
      color: var(--muted) !important;
    }
    /* å¼·èª¿è‰²æ–‡å­— */
    #presentation-overlay .text-cyan-300,
    #presentation-overlay .text-sky-300,
    #presentation-overlay .text-sky-200 {
      color: var(--accent) !important;
    }
    /* é€²åº¦æ¢å®¹å™¨ */
    #pres-progress-container {
      background: var(--panel) !important;
    }
    /* å¡ç‰‡èƒŒæ™¯ */
    #presentation-overlay [class*="bg-slate-900"] {
      background: var(--panel) !important;
    }
    /* é‚Šæ¡†é¡è‰² */
    #presentation-overlay [class*="border-slate"] {
      border-color: rgba(148,163,184,.2) !important;
    }
    /* æ¬¡è¦æ–‡å­— */
    #presentation-overlay .text-slate-400 {
      color: var(--muted) !important;
    }
    /* ç¼ºè€ƒå¡ç‰‡ */
    #presentation-overlay [class*="bg-rose-900"] {
      background: rgba(248,113,113,.15) !important;
    }
    #presentation-overlay [class*="border-rose-500"] {
      border-color: rgba(248,113,113,.3) !important;
    }
    #presentation-overlay [class*="text-rose"] {
      color: var(--bad) !important;
    }
    /* å¯¦åˆ°å¡ç‰‡ */
    #presentation-overlay [class*="bg-emerald-900"] {
      background: rgba(52,211,153,.15) !important;
    }
    #presentation-overlay [class*="border-emerald-500"] {
      border-color: rgba(52,211,153,.3) !important;
    }
    #presentation-overlay [class*="text-emerald"] {
      color: var(--good) !important;
    }
    .clock-hud.docked .clock-time { font-size: 0.875rem; }
    .clock-hud.docked .clock-date { font-size: 0.625rem; }
    .clock-hud.docked .clock-badge { font-size: 0.625rem; padding: 0.05rem 0.3rem; }
    .clock-hud.docked .flex { gap: 0.25rem !important; }
    .clock-hud .clock-actions, .clock-hud .snap-tip { display: none !important; }
    
    /* === æ·ºè‰²ä¸»é¡Œé–å®šæ¨¡å¼æ™‚é˜æ¨£å¼ï¼ˆä¸€èˆ¬æ¨¡å¼ï¼‰ === */
    [data-theme="light"] .clock-hud.docked {
      background: rgba(255,255,255,.9) !important;
      border: 1px solid rgba(37,99,235,.3) !important;
      border-radius: 0.5rem !important;
      padding: 0.25rem 0.5rem !important;
      box-shadow: 0 2px 8px rgba(0,0,0,.1) !important;
    }
    [data-theme="light"] .clock-hud.docked .clock-time {
      color: #2563eb !important;
    }
    [data-theme="light"] .clock-hud.docked .clock-date {
      color: #374151 !important;
    }
    [data-theme="light"] .clock-hud.docked .clock-badge {
      background: rgba(37,99,235,.15) !important;
      color: #2563eb !important;
      border-color: rgba(37,99,235,.3) !important;
    }
    
    /* === æ«»èŠ±ç²‰ä¸»é¡Œé–å®šæ¨¡å¼æ™‚é˜æ¨£å¼ï¼ˆä¸€èˆ¬æ¨¡å¼ï¼‰ === */
    [data-theme="light-soft"] .clock-hud.docked {
      background: rgba(255,245,247,.9) !important;
      border: 1px solid rgba(236,72,153,.4) !important;
      border-radius: 0.5rem !important;
      padding: 0.25rem 0.5rem !important;
      box-shadow: 0 2px 8px rgba(236,72,153,.15) !important;
    }
    [data-theme="light-soft"] .clock-hud.docked .clock-time {
      color: #ec4899 !important;
    }
    [data-theme="light-soft"] .clock-hud.docked .clock-date {
      color: #7f1d1d !important;
    }
    [data-theme="light-soft"] .clock-hud.docked .clock-badge {
      background: rgba(236,72,153,.2) !important;
      color: #ec4899 !important;
      border-color: rgba(236,72,153,.4) !important;
    }
	
	@import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap');

	/* è®“æ•¸å­—å›ºå®šå­—å¯¬ + å‹å–„ fallback */
	.clock-time,
	#pres-clock .clock-time {
	  font-variant-numeric: tabular-nums lining-nums;
	  font-feature-settings: "tnum","lnum";
	  font-family: 'Inter', 'Roboto Mono', system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans TC', sans-serif;
	  letter-spacing: .02em;
	}

	/* ä¿ç•™ç‰ˆä½ï¼šæ•¸å­— 2chã€å†’è™Ÿ 1ch */
	#hud-hh, #hud-mm, #hud-ss,
	#pres-hh, #pres-mm, #pres-ss {
	  display: inline-block;
	  width: 2ch;
	  text-align: center;
	}

	.clock-dot {
	  display: inline-block;
	  width: 1ch;
	  text-align: center;
	}

  </style>
</head>
<body onload="init()">
  <!-- ç‹€æ…‹æç¤º -->
  <div id="status-message" aria-live="polite" class="fixed top-4 left-1/2 -translate-x-1/2 px-4 py-2 text-sm text-white rounded-lg shadow-xl z-50 transition-opacity duration-300 opacity-0 pointer-events-none glass">
    æ“ä½œæˆåŠŸï¼
  </div>

  <!-- ä¸€èˆ¬æ¨¡å¼ å¤§æ™‚é˜ï¼ˆå°‡è¢«åµŒå…¥é ‚éƒ¨æ§åˆ¶åˆ—å³å´ï¼‰ -->
  <div id="clock-hud" class="clock-hud">
    <div class="clock-badge">ç¾åœ¨</div>
    <div class="flex flex-col leading-tight">
      <div class="clock-time">
        <span id="hud-hh">--</span><span class="clock-dot">:</span><span id="hud-mm">--</span><span class="clock-dot">:</span><span id="hud-ss">--</span>
      </div>
      <div id="hud-date" class="clock-date">--</div>
    </div>
    <div class="clock-actions hidden md:flex gap-1">
      <button id="hud-cycle">â‡²</button>
      <button id="hud-reset">âŸ³</button>
      <button id="hud-zoom-out" title="ç¸®å°">ï¼</button>
      <button id="hud-zoom-in" title="æ”¾å¤§">ï¼‹</button>
      <button id="hud-zoom-reset" title="é‡è¨­ç‚º 1x">1x</button>
    </div>
    <div class="snap-tip hidden md:block">å¯æ‹–æ›³</div>
  </div>

  <!-- ï¼ˆå·²ç§»é™¤ï¼šç¼ºè€ƒ Base64 åŒ¯å…¥ Modalï¼‰ -->

  <!-- æ’ç¨‹ CSV åŒ¯å…¥ Modal -->
  <div id="schedule-import-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 modal">
    <div class="card p-6 rounded-2xl shadow-2xl w-full max-w-2xl">
      <h3 class="text-xl font-bold text-cyan-300 mb-3">åŒ¯å…¥æ®µè€ƒæ’ç¨‹è³‡æ–™ï¼ˆCSVï¼‰</h3>
      <p class="text-sm text-slate-300 mb-2">è«‹å°‡ <strong>CSV æª”æ¡ˆçš„å®Œæ•´å…§å®¹</strong> è²¼å…¥ä¸‹æ–¹æ–‡å­—æ¡†ï¼ˆéœ€åŒ…å«æ¨™é¡Œåˆ—ï¼‰ã€‚</p>
      <p class="text-xs text-cyan-300 mb-3">CSV æ¨™é¡Œåˆ—ï¼šDayKey,DayName,StartTime,EndTime,SubjectName,ActivityType</p>
      <textarea id="schedule-import-data-textarea" class="w-full h-48 p-2 rounded-lg bg-slate-800/70 border border-slate-600 text-slate-100 focus:ring-focus text-sm" placeholder="è²¼ä¸Š CSV å…§å®¹..."></textarea>
      <div class="flex justify-end gap-2 mt-4">
        <button id="btn-schedule-cancel" class="btn btn-gray">å–æ¶ˆ</button>
        <button id="btn-schedule-confirm" class="btn btn-teal">ç¢ºèªåŒ¯å…¥ä¸¦å–ä»£</button>
      </div>
    </div>
  </div>

  <!-- æ‡‰åˆ°äººæ•¸è¨­å®š Modal -->
  <div id="expected-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 modal">
    <div class="card p-6 rounded-2xl shadow-2xl w-full max-w-sm">
      <h3 class="text-xl font-bold text-cyan-300 mb-3">è¨­å®šæ‡‰åˆ°äººæ•¸</h3>
      <label for="expected-input" class="text-sm text-slate-300">è«‹è¼¸å…¥æœ¬æ¬¡è€ƒè©¦æ‡‰åˆ°äººæ•¸ï¼š</label>
      <input id="expected-input" type="number" min="0" class="mt-2 w-full p-2 rounded-lg bg-slate-800/70 border border-slate-600 text-slate-100 focus:ring-focus" placeholder="ä¾‹å¦‚ï¼š30" />
      <div class="flex justify-end gap-2 mt-4">
        <button id="btn-expected-cancel" class="btn btn-gray">å–æ¶ˆ</button>
        <button id="btn-expected-confirm" class="btn btn-teal">ç¢ºå®š</button>
      </div>
    </div>
  </div>

  <!-- ç¼ºè€ƒåº§è™Ÿè¨­å®š Modal -->
  <div id="absent-setup-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 modal">
    <div class="card p-6 rounded-2xl shadow-2xl w-full max-w-lg">
      <h3 class="text-xl font-bold text-rose-300 mb-3">è¨­å®šç¼ºè€ƒåº§è™Ÿ</h3>
      <p class="text-xs text-slate-300 mb-2">å¯ç”¨é€—è™Ÿã€ç©ºæ ¼æˆ–æ›è¡Œåˆ†éš”ï¼›åƒ…æ•¸å­—æœƒè¢«ä¿ç•™ä¸¦è‡ªå‹•æ’åºã€‚</p>
      <textarea id="absent-setup-textarea" class="w-full h-36 p-2 rounded-lg bg-slate-800/70 border border-rose-400/40 text-slate-100 focus:ring-focus" placeholder="ä¾‹å¦‚ï¼š1, 5 12
25"></textarea>
      <div class="flex justify-end gap-2 mt-4">
        <button id="btn-absent-setup-cancel" class="btn btn-gray">å–æ¶ˆ</button>
        <button id="btn-absent-setup-confirm" class="btn btn-rose">ç¢ºå®š</button>
      </div>
    </div>
  </div>

  <!-- ä¸»å®¹å™¨ -->
  <div class="main-container">
    <!-- é ‚éƒ¨æ§åˆ¶åˆ— -->
    <div id="top-toolbar" class="card p-4 rounded-2xl shadow-md border-b-2 border-b-sky-500 flex flex-wrap items-center justify-between gap-2">
      <div class="flex items-center gap-2">
        <h1 id="page-title" class="text-xl md:text-2xl font-extrabold text-slate-100 focus:outline-none focus:ring-2 focus:ring-cyan-400/50 rounded px-1" contenteditable="true" title="é»æ“Šå³å¯ç·¨è¼¯æ¨™é¡Œ">114å¹´åº¦ç¬¬ä¸‰æ¬¡å®šæœŸè©•é‡</h1>
      </div>
      <div class="flex flex-wrap items-center gap-2 flex-1 min-w-0">
        <div id="day-buttons-container" class="flex gap-2 flex-shrink-0"></div>
        
        <!-- CSV åŠŸèƒ½ä¸‹æ‹‰é¸å–® -->
        <div class="dropdown-menu flex-shrink-0" id="csv-dropdown">
          <button class="icon-btn" id="btn-csv-menu" title="è¨­å®šé¸å–®">âš™ï¸</button>
          <div class="dropdown-content">
            <!-- é¡¯ç¤ºè¨­å®šå€ -->
            <div class="px-3 py-2">
              <div class="text-xs font-semibold text-slate-400 mb-2 uppercase tracking-wide">é¡¯ç¤ºè¨­å®š</div>
              <label class="toggle-label dropdown-toggle-item">
                <span>é¡¯ç¤ºæ™‚é˜</span>
                <span class="toggle-switch">
                  <input type="checkbox" id="toggle-clock" />
                  <span class="toggle-slider"></span>
                </span>
              </label>
              <label class="toggle-label dropdown-toggle-item">
                <span>é¡¯ç¤ºä¸‹èª²æ™‚é–“</span>
                <span class="toggle-switch">
                  <input type="checkbox" id="toggle-breaks" />
                  <span class="toggle-slider"></span>
                </span>
              </label>
              <label class="toggle-label dropdown-toggle-item">
                <span>é¡¯ç¤ºè‡ªç¿’</span>
                <span class="toggle-switch">
                  <input type="checkbox" id="toggle-study" />
                  <span class="toggle-slider"></span>
                </span>
              </label>
              <label class="toggle-label dropdown-toggle-item">
                <span>é¡¯ç¤ºé€²åº¦æ¢</span>
                <span class="toggle-switch">
                  <input type="checkbox" id="toggle-progress" />
                  <span class="toggle-slider"></span>
                </span>
              </label>
            </div>
            <div class="dropdown-divider"></div>
            <!-- ä¸»é¡Œé¸æ“‡å€ -->
            <div class="px-3 py-2">
              <div class="text-xs font-semibold text-slate-400 mb-2 uppercase tracking-wide">ä½ˆæ™¯ä¸»é¡Œ</div>
              <div class="grid grid-cols-2 gap-2">
                <button class="theme-btn" data-theme="dark" title="æš—è‰²ä¸»é¡Œ">
                  <div class="theme-preview dark-theme"></div>
                  <span class="text-xs">æš—è‰²</span>
                </button>
                <button class="theme-btn" data-theme="blackboard" title="é»‘æ¿ä¸»é¡Œ">
                  <div class="theme-preview blackboard-theme"></div>
                  <span class="text-xs">é»‘æ¿</span>
                </button>
                <button class="theme-btn" data-theme="light" title="æ·ºè‰²ä¸»é¡Œ">
                  <div class="theme-preview light-theme"></div>
                  <span class="text-xs">æ·ºè‰²</span>
                </button>
                <button class="theme-btn" data-theme="light-soft" title="æ·ºè‰²ä¸»é¡Œï¼ˆæ«»èŠ±ç²‰è‰²ç³»ï¼‰">
                  <div class="theme-preview light-soft-theme"></div>
                  <span class="text-xs">æ«»èŠ±ç²‰</span>
                </button>
                <button class="theme-btn" data-theme="blue" title="è—è‰²ä¸»é¡Œ">
                  <div class="theme-preview blue-theme"></div>
                  <span class="text-xs">è—è‰²</span>
                </button>
                <button class="theme-btn" data-theme="purple" title="ç´«è‰²ä¸»é¡Œ">
                  <div class="theme-preview purple-theme"></div>
                  <span class="text-xs">ç´«è‰²</span>
                </button>
                <button class="theme-btn" data-theme="warm" title="æš–è‰²ä¸»é¡Œ">
                  <div class="theme-preview warm-theme"></div>
                  <span class="text-xs">æš–è‰²</span>
                </button>
                <button class="theme-btn" data-theme="high-contrast" title="é«˜å°æ¯”ä¸»é¡Œ">
                  <div class="theme-preview high-contrast-theme"></div>
                  <span class="text-xs">é«˜å°æ¯”</span>
                </button>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <!-- CSV åŠŸèƒ½å€ -->
            <div class="px-1">
              <div class="dropdown-item" id="menu-import">
                <span>ğŸ“¥</span>
                <span>åŒ¯å…¥æ’ç¨‹ (CSV)</span>
              </div>
              <div class="dropdown-item" id="menu-export">
                <span>ğŸ“¤</span>
                <span>åŒ¯å‡ºæ’ç¨‹ (CSV)</span>
              </div>
              <div class="dropdown-divider"></div>
              <div class="dropdown-item" id="menu-sample">
                <span>ğŸ“‹</span>
                <span>ä¸‹è¼‰ CSV ç¯„ä¾‹</span>
              </div>
            </div>
          </div>
        </div>

        <!-- æŒ‰éˆ•å®¹å™¨ -->
        <div class="flex items-center gap-2 flex-shrink-0">
          <!-- å…¨è¢å¹•æŒ‰éˆ• -->
          <div class="tooltip-wrapper">
            <button id="btn-fullscreen" class="icon-btn" aria-pressed="false" title="åˆ‡æ›å…¨è¢å¹•">â¤¢</button>
            <div class="tooltip">å…¨è¢å¹• (F)</div>
          </div>

          <!-- å…¨ç•«é¢å±•ç¤ºæŒ‰éˆ• -->
          <div class="tooltip-wrapper">
            <button id="btn-present" class="icon-btn" aria-pressed="false" title="å…¨ç•«é¢å±•ç¤º">ğŸ–¥ï¸</button>
            <div class="tooltip">å…¨ç•«é¢å±•ç¤º (X)</div>
          </div>
        </div>
      </div>
      
      <!-- æ™‚é˜å®¹å™¨ï¼ˆé å³å°é½Šï¼‰ -->
      <div id="clock-hud-holder" class="flex-shrink-0"></div>
    </div>

    <!-- å…§å®¹å€ -->
    <div class="flex-grow flex flex-col lg:flex-row gap-4 min-h-0">
      <!-- å·¦å´ -->
      <div class="w-full lg:w-2/3 flex flex-col gap-4 min-h-0">
        <!-- ï¼ˆå·²ç§»é™¤ï¼šç•¶å‰æ—¥æœŸå¡ç‰‡ï¼‰ -->

        <!-- ç•¶å‰è€ƒç§‘é¡¯ç¤º -->
        <main id="hero" class="flex-grow flex flex-col justify-center items-center rounded-2xl shadow-xl p-8 transition-colors duration-300" style="background: linear-gradient(145deg, rgba(2,132,199,.15), rgba(67,56,202,.12));">
          <h2 class="text-2xl md:text-3xl font-bold text-slate-200 mb-4">ç›®å‰é€²è¡Œè€ƒç§‘</h2>
          <div class="rounded-2xl shadow-inner px-6 py-5 bg-slate-900/60 border border-slate-700">
            <p id="current-subject" class="text-5xl md:text-6xl font-black text-center text-sky-300">-- ç­‰å¾…æ’ç¨‹ --</p>
          </div>
          <p id="subject-time-range" class="mt-4 text-3xl md:text-4xl font-medium text-slate-300">( --:-- è‡³ --:-- )</p>
          <div id="subject-progress-container" class="w-full max-w-xl mt-6 bg-slate-800 rounded-full h-4 shadow-inner overflow-hidden">
            <div id="subject-progress-bar" class="h-full rounded-full flex items-center justify-end pr-2 font-bold transition-all duration-700 bg-amber-400 text-slate-900" style="width:0%">
              <span id="subject-progress-text" class="text-xs">0%</span>
            </div>
          </div>
        </main>

        <!-- ç¼ºè€ƒå€å¡Š -->
        <section class="card p-5 rounded-2xl border border-rose-400/30">
          <div class="flex justify-between items-center mb-3 p-2 rounded-md">
            <h2 class="text-2xl font-semibold text-rose-300 flex items-center">ç¼ºè€ƒåº§è™Ÿè¿½è¹¤</h2>
            <div class="flex items-center gap-2">
              <button id="btn-open-expected" class="btn btn-teal" title="è¨­å®šæ‡‰åˆ°äººæ•¸">è¨­å®šæ‡‰åˆ°äººæ•¸</button>
              <button id="btn-open-absent" class="btn btn-rose" title="è¨­å®šç¼ºè€ƒåº§è™Ÿ">è¨­å®šç¼ºè€ƒåº§è™Ÿ</button>
            </div>
          </div>

          <div class="grid grid-cols-3 gap-3 mb-4 text-center">
            <div class="bg-slate-800/70 p-2 rounded-lg border border-slate-700">
              <p class="text-xs font-medium text-slate-300">æ‡‰åˆ°äººæ•¸</p>
              <p id="expected-count" class="text-5xl md:text-6xl font-bold text-slate-100">30</p>
            </div>
            <div class="bg-rose-900/30 p-2 rounded-lg border border-rose-500/30">
              <p class="text-xs font-medium text-rose-300">ç¼ºè€ƒäººæ•¸</p>
              <p id="absent-count" class="text-5xl md:text-6xl font-bold text-rose-200">0</p>
            </div>
            <div class="bg-emerald-900/30 p-2 rounded-lg border border-emerald-500/30">
              <p class="text-xs font-medium text-emerald-300">å¯¦åˆ°äººæ•¸</p>
              <p id="actual-count" class="text-5xl md:text-6xl font-bold text-emerald-200">30</p>
            </div>
          </div>

          <div class="mt-3 p-3 bg-slate-900/60 border border-rose-500/20 rounded-md">
            <p class="font-medium text-rose-300 mb-1 text-sm">ç›®å‰ç¼ºè€ƒåº§è™Ÿï¼š</p>
            <div id="absent-seat-display" class="text-lg font-extrabold text-rose-200">å°šç„¡ç¼ºè€ƒè¨˜éŒ„ã€‚</div>
          </div>

          <div id="absent-input-area" class="hidden mt-4"></div>

          <!-- ï¼ˆå·²ç§»é™¤ï¼šç¼ºè€ƒåº§è™Ÿ åŒ¯å‡º(Base64)/åŒ¯å…¥ æŒ‰éˆ•åˆ—ï¼‰ -->
        </section>
      </div>

      <!-- å³å´ï¼šæ’ç¨‹æ¦‚è¦½ -->
      <div class="w-full lg:w-1/3 card p-6 rounded-2xl shadow-xl flex flex-col min-h-0">
        <h2 id="schedule-title" class="text-2xl font-bold text-slate-100 mb-4 pb-2 border-b border-slate-700 flex-shrink-0">
          æ’ç¨‹æ¦‚è¦½
        </h2>
        <div id="schedule-timeline" class="schedule-list space-y-4">
          <h3 class="sticky top-0 z-10 text-lg font-bold text-sky-300 p-1 border-b border-slate-700 bg-slate-900/70 backdrop-blur">â˜€ï¸ ä¸Šåˆæ™‚æ®µ</h3>
          <div id="morning-schedule" class="space-y-2"></div>
          <div id="lunch-break-item" class="p-2 my-2 rounded-md text-center text-slate-200 font-semibold text-sm flex-shrink-0 bg-slate-800 border border-slate-700">
            åˆä¼‘æ™‚é–“ (11:45 - 13:05)
          </div>
          <h3 class="sticky top-[38px] z-10 text-lg font-bold text-violet-300 p-1 border-b border-slate-700 bg-slate-900/70 backdrop-blur">ğŸŒ™ ä¸‹åˆæ™‚æ®µ</h3>
          <div id="afternoon-schedule" class="space-y-2"></div>
        </div>
        <p class="text-[11px] text-slate-400 mt-3 text-center">æ™‚é–“æŒçºŒæ›´æ–°ä¸­â€¦</p>
      </div>
    </div>
  </div>

  <script>
    /* ===== æ—¢æœ‰ç‹€æ…‹/å‡½å¼ï¼ˆåŸå§‹ç¢¼ç•¥ï¼‰ ===== */
    let expectedCount = Number(localStorage.getItem('expectedCount')) || 30;
    let isAbsentInputVisible = false;
    // é è¨­ç‚ºé¡¯ç¤ºæ™‚é˜ï¼ˆshowClock = trueï¼‰
    let showClock = localStorage.getItem('showClock') !== null ? localStorage.getItem('showClock') === 'true' : true;
    // é è¨­ç‚ºéš±è—ä¸‹èª²æ™‚é–“ï¼ˆhideBreaks = trueï¼‰
    let hideBreaks = localStorage.getItem('hideBreaks') !== null ? localStorage.getItem('hideBreaks') === 'true' : true;
    // é è¨­ç‚ºéš±è—è‡ªç¿’ï¼ˆhideStudy = trueï¼‰
    let hideStudy = localStorage.getItem('hideStudy') !== null ? localStorage.getItem('hideStudy') === 'true' : true;
    // é è¨­ç‚ºé¡¯ç¤ºé€²åº¦æ¢ï¼ˆshowProgress = trueï¼‰
    let showProgress = localStorage.getItem('showProgress') !== null ? localStorage.getItem('showProgress') === 'true' : true;

    /* === å…¨åŸŸé–å®šæ——æ¨™ï¼štrue = å›ºå®š / ä¸å¯ç¸®æ”¾ / ä¸å¯æ‹–æ›³ / ä¸å¯é¡¯ç¤ºéš±è— === */
    const CLOCK_LOCKED = true;

    let initialSchedules = {
      day1:{ name:'1/16 æ˜ŸæœŸäº”', data:[
        {start:'08:10',end:'08:50',name:'è‡ªç¿’ (40åˆ†)',type:'study'},
        {start:'08:50',end:'09:00',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'09:00',end:'10:00',name:'æ•¸å­¸ (60åˆ†)',type:'exam'},
        {start:'10:00',end:'10:10',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'10:10',end:'10:40',name:'è‡ªç¿’ (30åˆ†)',type:'study'},
        {start:'10:40',end:'10:55',name:'ä¸‹èª² (15åˆ†)',type:'break'},
        {start:'10:55',end:'11:45',name:'å¼•å°å¯«ä½œ (50åˆ†)',type:'exam'},
        {start:'11:45',end:'13:05',name:'ä¸­åˆä¼‘æ¯ (80åˆ†)',type:'break'},
        {start:'13:05',end:'13:50',name:'è‡ªç¿’ (45åˆ†)',type:'study'},
        {start:'13:50',end:'14:00',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'14:00',end:'15:00',name:'è‹±æ–‡ (60åˆ†)',type:'exam'},
        {start:'15:00',end:'15:10',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'15:10',end:'15:40',name:'è‡ªç¿’ (30åˆ†)',type:'study'},
        {start:'15:40',end:'15:50',name:'æ”¾å­¸æ™‚é–“',type:'end'},
      ]},
      day2:{ name:'1/19 æ˜ŸæœŸä¸€', data:[
        {start:'08:10',end:'08:40',name:'è‡ªç¿’ (30åˆ†)',type:'study'},
        {start:'08:40',end:'08:50',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'08:50',end:'09:50',name:'åœ‹æ–‡ (60åˆ†)',type:'exam'},
        {start:'09:50',end:'10:00',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'10:00',end:'10:30',name:'è‡ªç¿’ (30åˆ†)',type:'study'},
        {start:'10:30',end:'10:45',name:'ä¸‹èª² (15åˆ†)',type:'break'},
        {start:'10:45',end:'11:45',name:'è‡ªç„¶ (60åˆ†)',type:'exam'},
        {start:'11:45',end:'13:05',name:'ä¸­åˆä¼‘æ¯ (80åˆ†)',type:'break'},
        {start:'13:05',end:'13:50',name:'è‡ªç¿’ (45åˆ†)',type:'study'},
        {start:'13:50',end:'14:00',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'14:00',end:'14:30',name:'è‡ªç¿’ (30åˆ†)',type:'study'},
        {start:'14:30',end:'14:40',name:'ä¸‹èª² (10åˆ†)',type:'break'},
        {start:'14:40',end:'15:40',name:'ç¤¾æœƒ (60åˆ†)',type:'exam'},
        {start:'15:40',end:'15:45',name:'æ”¶å·',type:'break'},
        {start:'15:45',end:'15:55',name:'å­¸å‹™è™•å»£æ’­çµ±ä¸€æ”¾å­¸',type:'end'},
      ]},
    };

    let currentDay = 'day1';
    let currentScheduleData = initialSchedules[currentDay];

    const el = (id)=>document.getElementById(id);
    const currentSubjectEl=el('current-subject');
    const subjectTimeRangeEl=el('subject-time-range');
    const subjectProgressBarEl=el('subject-progress-bar');
    const subjectProgressTextEl=el('subject-progress-text');
    const morningScheduleEl=el('morning-schedule');
    const afternoonScheduleEl=el('afternoon-schedule');
    const lunchBreakItemEl=el('lunch-break-item');
    const absentInput=document.createElement('textarea'); // éš±è—ä¾›é‚è¼¯
    const absentDisplay=el('absent-seat-display');
    const absentCountEl=el('absent-count');
    const actualCountEl=el('actual-count');
    const expectedCountEl=el('expected-count');

    const scheduleImportModal=el('schedule-import-modal');
    const scheduleImportDataTextarea=el('schedule-import-data-textarea');
    const dayButtonsContainer=el('day-buttons-container');

    const toggleClock=el('toggle-clock');
    const toggleBreaks=el('toggle-breaks');
    const toggleStudy=el('toggle-study');
    const toggleProgress=el('toggle-progress');
    const csvDropdown=el('csv-dropdown');
    const btnCsvMenu=el('btn-csv-menu');
    const menuImport=el('menu-import');
    const menuExport=el('menu-export');
    const menuSample=el('menu-sample');
    const btnPresent=el('btn-present');
    const btnFullscreen=el('btn-fullscreen');
    const pageTitleEl=el('page-title');

    const btnOpenExpected=el('btn-open-expected');
    const btnOpenAbsent=el('btn-open-absent');

    const expectedModal=el('expected-modal');
    const expectedInput=el('expected-input');
    const btnExpectedCancel=el('btn-expected-cancel');
    const btnExpectedConfirm=el('btn-expected-confirm');

    const absentSetupModal=el('absent-setup-modal');
    const absentSetupTextarea=el('absent-setup-textarea');
    const btnAbsentSetupCancel=el('btn-absent-setup-cancel');
    const btnAbsentSetupConfirm=el('btn-absent-setup-confirm');

    const presentationOverlay=()=>el('presentation-overlay');

    /* === v1.0.1 æ–°å¢ï¼šå±•ç¤ºå±¤æ™‚é˜ HUDï¼ˆæ”¾åœ¨ overlay è£¡ï¼‰ === */
  </script>

  <footer class="fixed bottom-2 right-4 text-[12px] text-slate-400/60 select-none">Developed by <span class="font-semibold">DennisZ</span> â€¢ v1.0.1</footer>

  <!-- å…¨ç•«é¢å±•ç¤ºè¦†è“‹å±¤ -->
  <div id="presentation-overlay" class="hidden fixed inset-0 z-[60] bg-slate-950 text-slate-100">
    <div class="absolute inset-0 flex flex-col">
      <!-- åŠ ä¸Š id ä»¥ä¾¿å°‡å±•ç¤ºæ™‚é˜åµŒå…¥ -->
      <div id="present-toolbar" class="flex items-center justify-between p-4 border-b border-slate-800 bg-slate-900/70">
        <div class="text-sm text-slate-300 space-x-3">
          <span>æŒ‰ <span class="font-bold">X</span> é–‹å•Ÿ/é—œé–‰å±•ç¤º</span>
          <span>æŒ‰ <span class="font-bold">F</span> é€²å…¥/é€€å‡ºå…¨è¢å¹•</span>
          <span>æŒ‰ <span class="font-bold">Esc</span> é—œé–‰</span>
        </div>
        <div class="hidden text-sm text-slate-300">
          ç›®å‰æ™‚é–“ï¼š<span id="pres-now" class="font-semibold text-cyan-300">--</span>
        </div>
        <button id="btn-close-present" class="btn btn-gray">é—œé–‰</button>
      </div>

      <!-- å±•ç¤ºæ¨¡å¼æ™‚é˜ï¼ˆå°‡è¢«åµŒå…¥ present-toolbarï¼‰ -->
      <div id="pres-clock" class="clock-hud hidden md:flex">
        <div class="clock-badge">ç¾åœ¨æ™‚é–“</div>
        <div class="flex flex-col leading-tight">
          <div class="clock-time">
            <span id="pres-hh">--</span><span class="clock-dot">:</span><span id="pres-mm">--</span><span class="clock-dot">:</span><span id="pres-ss">--</span>
          </div>
          <div id="pres-date" class="clock-date">--</div>
        </div>
        <div class="clock-actions flex gap-1 ml-1">
          <button id="pres-cycle" title="å¾ªç’°è§’è½">â‡²</button>
          <button id="pres-zoom-out" title="ç¸®å°">ï¼</button>
          <button id="pres-zoom-in" title="æ”¾å¤§">ï¼‹</button>
        </div>
      </div>

      <div class="flex-1 grid place-items-center p-6">
        <div class="w-full max-w-5xl text-center">
          <div class="mb-6">
            <div class="text-xl text-sky-300 tracking-widest">ç›®å‰é€²è¡Œè€ƒç§‘</div>
            <div id="pres-subject" class="mt-2 text-6xl md:text-7xl font-black text-sky-300">â€”</div>
            <div id="pres-range" class="mt-2 text-4xl md:text-5xl text-slate-300">â€”</div>
            <div id="pres-progress-container" class="w-full max-w-3xl mx-auto mt-6 bg-slate-800 rounded-full h-5 shadow-inner overflow-hidden">
              <div id="pres-progress-bar" class="h-full rounded-full flex items-center justify-end pr-2 font-bold transition-all duration-700 bg-amber-400 text-slate-900" style="width:0%">
                <span id="pres-progress-text" class="text-xs">0%</span>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
            <div class="p-4 rounded-2xl bg-slate-900/70 border border-slate-700">
              <div class="text-sm text-slate-400">æ‡‰åˆ°äººæ•¸</div>
              <div id="pres-expected" class="text-5xl font-extrabold">â€”</div>
            </div>
            <div class="p-4 rounded-2xl bg-rose-900/30 border border-rose-500/30">
              <div class="text-sm text-rose-300">ç¼ºè€ƒäººæ•¸ / åº§è™Ÿ</div>
              <div class="text-5xl font-extrabold text-rose-200"><span id="pres-absent-count">0</span></div>
              <div id="pres-absent-list" class="mt-2 text-lg font-bold text-rose-200 break-words">â€”</div>
            </div>
            <div class="p-4 rounded-2xl bg-emerald-900/30 border border-emerald-500/30">
              <div class="text-sm text-emerald-300">å¯¦åˆ°äººæ•¸</div>
              <div id="pres-actual" class="text-5xl font-extrabold text-emerald-200">â€”</div>
            </div>
          </div>

          <div class="mt-8 p-4 rounded-2xl bg-slate-900/70 border border-slate-700">
            <div class="text-sm text-slate-400">ä¸‹ä¸€å€‹ study / exam</div>
            <div id="pres-next" class="text-2xl md:text-3xl font-bold text-sky-200 mt-1">â€”</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  /* ===== åŸåŠŸèƒ½ï¼šå·¥å…·å‡½å¼ ===== */
  const parseTime=(t)=>{const [h,m]=t.split(':').map(Number);const d=new Date();d.setHours(h,m,0,0);return d}
  const within=(now,s,e)=>now>=s&&now<e;
  function getSplitSchedules(scheduleData){
    const lunchIndex=scheduleData.findIndex(i=>i.start==='11:45'&&i.end==='13:05');
    if(lunchIndex===-1) return {morning:scheduleData,lunch:null,afternoon:[]};
    return {morning:scheduleData.slice(0,lunchIndex),lunch:scheduleData[lunchIndex],afternoon:scheduleData.slice(lunchIndex+1)};
  }
  function renderScheduleSegment(schedule,targetEl,startIndex){
    targetEl.innerHTML='';
    schedule.forEach((item,idx)=>{
      const originalIndex=startIndex+idx;
      let colorClass='text-slate-200',icon='ğŸ';
      if(item.type==='exam'){colorClass='text-sky-300 font-semibold';icon='ğŸ“'}
      else if(item.type==='study'){colorClass='text-violet-300';icon='ğŸ“š'}
      else if(item.type==='break'){colorClass='text-emerald-300';icon='â˜•'}
      const shouldHide = (hideBreaks && item.type === 'break') || (hideStudy && item.type === 'study');
      const html=`
      <div id="schedule-item-${originalIndex}" class="timeline-item ${item.type} py-1 pr-2 cursor-pointer rounded-md hover:bg-slate-800/60 ${shouldHide ? 'hidden' : ''}"
           data-type="${item.type}" data-index="${originalIndex}">
        <div class="timeline-indicator"></div>
        <div class="flex items-center gap-2">
          <div class="text-xs font-bold w-12 flex-shrink-0 text-slate-400">${item.start}</div>
          <div class="flex-grow">
            <div class="text-sm ${colorClass}">${icon} ${item.name}</div>
            <div class="text-[11px] text-slate-500">çµæŸ: ${item.end}</div>
          </div>
        </div>
      </div>`;
      targetEl.insertAdjacentHTML('beforeend',html);
    });
  }
  function renderDayButtons(){
    dayButtonsContainer.innerHTML='';
    Object.keys(initialSchedules).sort().forEach(day=>{
      const schedule=initialSchedules[day];
      const isActive=day===currentDay;
      const btn=document.createElement('button');
      btn.id=`${day}-btn`; btn.textContent=schedule.name;
      btn.className=`btn ${isActive?'bg-indigo-500 text-white':'btn-gray'}`;
      btn.addEventListener('click',()=>loadSchedule(day));
      dayButtonsContainer.appendChild(btn);
    });
  }
  function loadSchedule(day){
    if(!initialSchedules[day]){
      const first=Object.keys(initialSchedules)[0];
      if(!first){ currentScheduleData=null; renderDayButtons(); renderSchedule(); updateDisplay(); return;}
      day=first;
    }
    currentDay=day;
    currentScheduleData=initialSchedules[currentDay];
    currentScheduleData.split=getSplitSchedules(currentScheduleData.data);
    renderDayButtons();
    // ï¼ˆå·²ç§»é™¤ï¼‰å·¦å´æ—¥æœŸå¡ç‰‡ï¼Œä¸å†æ›´æ–° current-schedule-date
    document.getElementById('schedule-title').textContent=`æ’ç¨‹æ¦‚è¦½ (${currentScheduleData.name})`;
    renderSchedule(); updateDisplay();
  }
  function renderSchedule(){
    if(!currentScheduleData||!currentScheduleData.data){
      morningScheduleEl.innerHTML='<p class="text-center text-slate-400">ç„¡æ’ç¨‹è³‡æ–™</p>';
      afternoonScheduleEl.innerHTML=''; lunchBreakItemEl.textContent='åˆä¼‘æ™‚é–“';
      lunchBreakItemEl.classList.remove('bg-slate-800'); return;
    }
    const {morning,lunch,afternoon}=currentScheduleData.split;
    renderScheduleSegment(morning,morningScheduleEl,0);
    const lunchIndex=currentScheduleData.data.findIndex(i=>i===lunch);
    const afternoonStartIndex=lunchIndex!==-1?lunchIndex+1:morning.length;
    renderScheduleSegment(afternoon,afternoonScheduleEl,afternoonStartIndex);
    if(lunch){
      const dur=Math.floor((parseTime(lunch.end)-parseTime(lunch.start))/60000);
      lunchBreakItemEl.innerHTML=`åˆä¼‘æ™‚é–“ ${lunch.start} - ${lunch.end} (${dur} åˆ†)`;
      lunchBreakItemEl.dataset.start=lunch.start;
      lunchBreakItemEl.dataset.end=lunch.end;
      lunchBreakItemEl.id=`schedule-item-${lunchIndex}`;
      lunchBreakItemEl.classList.add('bg-slate-800');
      if(hideBreaks){
        lunchBreakItemEl.classList.add('hidden');
      }else{
        lunchBreakItemEl.classList.remove('hidden');
      }
    }else{ lunchBreakItemEl.classList.add('hidden'); }
  }
  function computeAbsentFromRaw(raw){
    const cleaned=raw.replace(/[,ï¼Œ\s\n]+/g,' ').trim();
    const nums=cleaned.split(' ').map(s=>s.trim()).filter(s=>s&&/^\d+$/.test(s)).map(Number).sort((a,b)=>a-b);
    return [...new Set(nums)];
  }
  function updateAbsentSeats(){
    const raw=absentInput.value||'';
    const unique=computeAbsentFromRaw(raw);
    const absentCount=unique.length;
    const actual=Math.max(0, expectedCount-absentCount);
    absentDisplay.textContent=absentCount?unique.join('ã€ '):'å°šç„¡ç¼ºè€ƒè¨˜éŒ„ã€‚';
    expectedCountEl.textContent=expectedCount;
    absentCountEl.textContent=absentCount;
    actualCountEl.textContent=actual;
    localStorage.setItem('absentSeats', raw);
  }
  function showStatusMessage(message,isError=false){
    const statusMessageEl=document.getElementById('status-message');
    statusMessageEl.textContent=message;
    statusMessageEl.classList.remove('opacity-0');
    statusMessageEl.style.background=isError?'rgba(244,63,94,.9)':'rgba(16,185,129,.9)';
    statusMessageEl.style.pointerEvents='auto';
    clearTimeout(window.__statusTimer);
    window.__statusTimer=setTimeout(()=>{
      statusMessageEl.classList.add('opacity-0');
      statusMessageEl.style.pointerEvents='none';
    },2200);
  }

  /* ===== CSV/ä¸‹è¼‰ï¼ˆåŸå‡½å¼ä¿ç•™ï¼‰ ===== */
  function convertToCsv(schedules){
    const header='DayKey,DayName,StartTime,EndTime,SubjectName,ActivityType\n';
    let csv=header;
    Object.keys(schedules).sort().forEach(key=>{
      const sc=schedules[key];
      sc.data.forEach(item=>{
        const row=[ key, `"${sc.name.replace(/"/g,'""')}"`, item.start, item.end, `"${item.name.replace(/"/g,'""')}"`, item.type ].join(',');
        csv+=row+'\n';
      });
    });
    return '\ufeff'+csv;
  }
  function parseCsv(csvString){
    const schedules={};
    csvString=csvString.replace(/^\ufeff/,'');
    const lines=csvString.split('\n').filter(l=>l.trim()!=='');
    if(lines.length<2) throw new Error('CSV å…§å®¹ä¸è¶³ï¼Œè«‹ç¢ºèªæ¨™é¡Œåˆ—èˆ‡è³‡æ–™åˆ—ã€‚');
    const dataLines=lines.slice(1);
    dataLines.forEach((line,i)=>{
      const values=line.match(/(?:[^,"]+|"[^"]*")+/g)?.map(v=>v.trim().replace(/^"|"$/g,'').replace(/""/g,'"'))||[];
      if(values.length!==6){ console.warn(`Line ${i+2} æ¬„ä½æ•¸ä¸ç¬¦ï¼Œå·²ç•¥éï¼š`,line); return;}
      const [DayKey,DayName,StartTime,EndTime,SubjectName,ActivityType]=values;
      if(!/^\d{2}:\d{2}$/.test(StartTime)||!/^\d{2}:\d{2}$/.test(EndTime)) throw new Error(`ç¬¬ ${i+2} è¡Œæ™‚é–“æ ¼å¼éŒ¯èª¤ï¼š${StartTime}-${EndTime}`);
      if(!['exam','break','study','end'].includes(ActivityType)) throw new Error(`ç¬¬ ${i+2} è¡Œæ´»å‹•é¡å‹éŒ¯èª¤ï¼š${ActivityType}`);
      if(!schedules[DayKey]) schedules[DayKey]={name:DayName,data:[]};
      schedules[DayKey].data.push({start:StartTime,end:EndTime,name:SubjectName,type:ActivityType});
    });
    return schedules;
  }
  function downloadFile(content,fileName,mimeType){
    const blob=new Blob([content],{type:mimeType});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=fileName; document.body.appendChild(a); a.click();
    document.body.removeChild(a); URL.revokeObjectURL(url);
  }
  function exportScheduleData(){
    if(!Object.keys(initialSchedules).length) return showStatusMessage('æ’ç¨‹è³‡æ–™ç‚ºç©ºï¼Œè«‹å…ˆåŒ¯å…¥æˆ–å»ºç«‹æ’ç¨‹ã€‚',true);
    const csv=convertToCsv(initialSchedules);
    downloadFile(csv,'exam_schedule.csv','text/csv;charset=utf-8;');
    showStatusMessage('æ’ç¨‹è³‡æ–™å·²æˆåŠŸåŒ¯å‡ºç‚º exam_schedule.csvï¼');
  }
  function downloadSampleCsv(){
    const csv=convertToCsv(initialSchedules);
    downloadFile(csv,'exam_schedule_sample.csv','text/csv;charset=utf-8;');
    showStatusMessage('CSV ç¯„ä¾‹æª”æ¡ˆå·²ä¸‹è¼‰ï¼');
  }

  /* ===== v1.0.1ï¼šå±•ç¤ºå±¤åŒæ­¥ ===== */
  function updatePresentationView(){
    const subject=document.getElementById('current-subject')?.textContent||'â€”';
    const range=document.getElementById('subject-time-range')?.textContent||'';
    const raw=absentInput?.value||'';
    const list=computeAbsentFromRaw(raw);
    const absentCount=list.length;
    const actual=Math.max(0, expectedCount-absentCount);
    el('pres-subject').textContent=subject;
    el('pres-range').textContent=range;
    el('pres-expected').textContent=String(expectedCount);
    el('pres-absent-count').textContent=String(absentCount);
    el('pres-absent-list').textContent=list.length?list.join('ã€ '):'â€”';
    el('pres-actual').textContent=String(actual);

    const now=new Date();
    const fmt={year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false};
    el('pres-now').textContent=now.toLocaleString('zh-TW',fmt);

    let pct=0,currentIndex=-1,currentItem=null,nextInfo='â€”';
    if(currentScheduleData && currentScheduleData.data){
      const schedule=currentScheduleData.data;
      for(let i=0;i<schedule.length;i++){
        const s=parseTime(schedule[i].start), e=parseTime(schedule[i].end);
        if(within(now,s,e)){ currentItem=schedule[i]; currentIndex=i; pct=Math.min(100,Math.round(((now-s)/(e-s))*100)); break;}
      }
      for(let j=currentIndex+1;j<schedule.length;j++){
        if(['study','exam'].includes(schedule[j].type)){ nextInfo=`${schedule[j].start}ã€€${schedule[j].name}`; break;}
      }
    }
    const bar=el('pres-progress-bar'); const txt=el('pres-progress-text');
    bar.style.width=pct+'%'; txt.textContent=pct+'%';
    el('pres-next').textContent=nextInfo;
  }
  function openPresentation(){
    updatePresentationView();
    presentationOverlay().classList.remove('hidden');
    // ä½¿ç”¨çµ±ä¸€çš„å‡½æ•¸ä¾†æ›´æ–°æ™‚é˜é¡¯ç¤ºç‹€æ…‹
    updateClockVisibility();
    if(!document.fullscreenElement){ document.documentElement.requestFullscreen?.().catch(()=>{}); }
  }
  function closePresentation(){
    presentationOverlay().classList.add('hidden');
    if(document.fullscreenElement){ document.exitFullscreen?.().catch(()=>{}); }
  }

  /* ===== å¤§æ™‚é˜ï¼ˆä¸€èˆ¬/å±•ç¤ºï¼‰ æ›´æ–° ===== */
  function fmtWeekday(d){ return ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][d.getDay()] }
  function pad(n){ return String(n).padStart(2,'0') }
  function tickClocks(){
    const now=new Date();
    const hh=pad(now.getHours()), mm=pad(now.getMinutes()), ss=pad(now.getSeconds());
    const dateStr=`${now.getFullYear()}/${pad(now.getMonth()+1)}/${pad(now.getDate())}ï¼ˆ${fmtWeekday(now)}ï¼‰`;
    const hudHH=el('hud-hh'); if(hudHH){ hudHH.textContent=hh; el('hud-mm').textContent=mm; el('hud-ss').textContent=ss; el('hud-date').textContent=dateStr; }
    const presHH=el('pres-hh'); if(presHH){ presHH.textContent=hh; el('pres-mm').textContent=mm; el('pres-ss').textContent=ss; el('pres-date').textContent=dateStr; }
  }

  /* ===== ä»ä¿ç•™ï¼šæ‹–æ›³/ç¸®æ”¾å·¥å…·ï¼ˆé–å®šæ™‚ä¸æœƒè¢«å•Ÿç”¨ï¼‰ ===== */
  function makeDraggable(box, storageKey){
    let dragging=false, startX=0, startY=0, startLeft=0, startTop=0;
    const setPos=(l,t)=>{ box.style.left=l+'px'; box.style.top=t+'px'; box.style.right='auto'; box.style.bottom='auto'; }
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
    function cycleCorner(){
      const rect=box.getBoundingClientRect();
      const vw=window.innerWidth, vh=window.innerHeight;
      const current=localStorage.getItem(storageKey+'-corner')||'tr';
      const order=['tr','br','bl','tl'];
      const next=order[(order.indexOf(current)+1)%order.length];
      localStorage.setItem(storageKey+'-corner', next);
      const margin=16;
      const map={
        tl:[margin,margin],
        tr:[vw-rect.width-margin, margin],
        br:[vw-rect.width-margin, vh-rect.height-margin],
        bl:[margin, vh-rect.height-margin],
      };
      setPos(...map[next]);
      localStorage.setItem(storageKey, JSON.stringify({left:map[next][0], top:map[next][1]}));
    }
    function onDown(e){
      dragging=true; box.classList.add('dragging');
      const rect=box.getBoundingClientRect();
      startLeft=rect.left; startTop=rect.top;
      startX = (e.touches? e.touches[0].clientX : e.clientX);
      startY = (e.touches? e.touches[0].clientY : e.clientY);
      e.preventDefault();
    }
    function onMove(e){
      if(!dragging) return;
      const x=(e.touches? e.touches[0].clientX : e.clientX);
      const y=(e.touches? e.touches[0].clientY : e.clientY);
      const dx=x-startX, dy=y-startY;
      const vw=window.innerWidth, vh=window.innerHeight;
      const rect=box.getBoundingClientRect();
      const left=clamp(startLeft+dx, 8, vw-rect.width-8);
      const top =clamp(startTop +dy, 8, vh-rect.height-8);
      setPos(left,top);
    }
    function onUp(){
      if(!dragging) return;
      dragging=false; box.classList.remove('dragging');
      const rect=box.getBoundingClientRect();
      localStorage.setItem(storageKey, JSON.stringify({left:rect.left, top:rect.top}));
    }
    box.addEventListener('mousedown', onDown);
    box.addEventListener('touchstart', onDown, {passive:false});
    window.addEventListener('mousemove', onMove);
    window.addEventListener('touchmove', onMove, {passive:false});
    window.addEventListener('mouseup', onUp);
    window.addEventListener('touchend', onUp);
    return { cycleCorner };
  }
  function restorePosition(box, storageKey, defaultCorner='tr'){
    const vw=window.innerWidth, vh=window.innerHeight;
    const saved=localStorage.getItem(storageKey);
    const margin=16;
    if(saved){
      try{
        const {left, top}=JSON.parse(saved);
        box.style.left=left+'px'; box.style.top=top+'px';
        box.style.right='auto'; box.style.bottom='auto';
        return;
      }catch{}
    }
    const rect=box.getBoundingClientRect();
    const map={
      tl:[margin,margin],
      tr:[vw-rect.width-margin, margin],
      br:[vw-rect.width-margin, vh-rect.height-margin],
      bl:[margin, vh-rect.height-margin],
    };
    const pos=map[defaultCorner]||map.tr;
    box.style.left=pos[0]+'px'; box.style.top=pos[1]+'px';
    box.style.right='auto'; box.style.bottom='auto';
    localStorage.setItem(storageKey, JSON.stringify({left:pos[0], top:pos[1]}));
    localStorage.setItem(storageKey+'-corner', defaultCorner);
  }
  function applyScale(elm, storageKey, defaultScale = 2){
    const raw = localStorage.getItem(storageKey);
    const s = raw ? Number(raw) : defaultScale;
    elm?.style?.setProperty('--clock-scale', s);
  }
  function changeScale(elm, storageKey, delta){
    const cur = Number(localStorage.getItem(storageKey)) || 2;
    let next = Math.round((cur + delta) * 10) / 10;
    next = Math.max(0.5, Math.min(4, next));
    localStorage.setItem(storageKey, String(next));
    elm?.style?.setProperty('--clock-scale', next);
    try{ showStatusMessage?.(`æ™‚é˜ç¸®æ”¾ï¼š${next}x`); }catch{}
  }
  function resetScale(elm, storageKey, to = 1){
    localStorage.setItem(storageKey, String(to));
    elm?.style?.setProperty('--clock-scale', to);
    try{ showStatusMessage?.(`æ™‚é˜ç¸®æ”¾ï¼š${to}x`); }catch{}
  }

  /* ===== ä¸»æ›´æ–° ===== */
  function updateDisplay(){
    if(!currentScheduleData||!currentScheduleData.data){
      currentSubjectEl.textContent='ç„¡æ’ç¨‹è³‡æ–™';
      subjectTimeRangeEl.textContent='---';
      subjectProgressBarEl.style.width='0%';
      subjectProgressTextEl.textContent='0%';
      return;
    }
    const schedule=currentScheduleData.data;
    const now=new Date();

    let currentItem=null,currentIndex=-1,pct=0;
    document.querySelectorAll('.timeline-item').forEach(el=>el.classList.remove('active'));
    for(let i=0;i<schedule.length;i++){
      const item=schedule[i];
      const s=parseTime(item.start), e=parseTime(item.end);
      if(within(now,s,e)){ currentItem=item; currentIndex=i; pct=Math.min(100, Math.round(((now-s)/(e-s))*100)); break; }
    }

    const hero=document.getElementById('hero');
    if(currentItem){
      currentSubjectEl.textContent=currentItem.name;
      subjectTimeRangeEl.textContent=`(${currentItem.start} è‡³ ${currentItem.end})`;
      subjectProgressBarEl.style.width=pct+'%';
      subjectProgressTextEl.textContent=pct+'%';

      // æ ¹æ“šä¸»é¡Œè¨­ç½®ä¸åŒçš„èƒŒæ™¯
      const currentTheme = document.documentElement.getAttribute('data-theme');
      if(currentTheme === 'light-soft'){
        // æ«»èŠ±ç²‰ä¸»é¡Œçš„ç‰¹æ®Šæ¼¸è®Š
        if(currentItem.type==='exam') hero.style.background='linear-gradient(145deg, rgba(236,72,153,.30), rgba(219,39,119,.25))';
        else if(currentItem.type==='break') hero.style.background='linear-gradient(145deg, rgba(251,191,36,.25), rgba(34,197,94,.20))';
        else if(currentItem.type==='study') hero.style.background='linear-gradient(145deg, rgba(236,72,153,.25), rgba(219,39,119,.20))';
        else hero.style.background='linear-gradient(145deg, rgba(236,72,153,.20), rgba(219,39,119,.15))';
      }else{
        // å…¶ä»–ä¸»é¡Œä½¿ç”¨åŸæœ‰æ¨£å¼
        if(currentItem.type==='exam') hero.style.background='linear-gradient(145deg, rgba(14,165,233,.20), rgba(99,102,241,.18))';
        else if(currentItem.type==='break') hero.style.background='linear-gradient(145deg, rgba(251,191,36,.20), rgba(34,197,94,.18))';
        else if(currentItem.type==='study') hero.style.background='linear-gradient(145deg, rgba(167,139,250,.22), rgba(56,189,248,.18))';
        else hero.style.background='linear-gradient(145deg, rgba(148,163,184,.15), rgba(100,116,139,.15))';
      }

      const itemEl=document.getElementById(`schedule-item-${currentIndex}`); if(itemEl) itemEl.classList.add('active');
    }else{
      currentSubjectEl.textContent='ä»Šæ—¥æ’ç¨‹å·²çµæŸ / å°šæœªé–‹å§‹';
      subjectTimeRangeEl.textContent='---';
      subjectProgressBarEl.style.width='0%';
      subjectProgressTextEl.textContent='0%';
      // æ ¹æ“šä¸»é¡Œè¨­ç½®ä¸åŒçš„èƒŒæ™¯
      const currentTheme = document.documentElement.getAttribute('data-theme');
      if(currentTheme === 'light-soft'){
        hero.style.background='linear-gradient(145deg, rgba(236,72,153,.20), rgba(219,39,119,.15))';
      }else{
        hero.style.background='linear-gradient(145deg, rgba(148,163,184,.12), rgba(100,116,139,.12))';
      }
    }

    if(!presentationOverlay().classList.contains('hidden')) updatePresentationView();
  }

  /* ===== ä¸»é¡Œåˆ‡æ›åŠŸèƒ½ ===== */
  function applyTheme(themeName){
    const htmlEl = document.documentElement;
    htmlEl.setAttribute('data-theme', themeName);
    localStorage.setItem('selectedTheme', themeName);
    
    // æ›´æ–°æ‰€æœ‰ä¸»é¡ŒæŒ‰éˆ•çš„ active ç‹€æ…‹
    document.querySelectorAll('.theme-btn').forEach(btn => {
      if(btn.getAttribute('data-theme') === themeName){
        btn.classList.add('active');
      }else{
        btn.classList.remove('active');
      }
    });
    
    showStatusMessage(`å·²åˆ‡æ›è‡³${getThemeName(themeName)}ä¸»é¡Œ`);
  }
  
  function getThemeName(themeKey){
    const themeNames = {
      'dark': 'æš—è‰²',
      'blackboard': 'é»‘æ¿',
      'light': 'æ·ºè‰²',
      'light-soft': 'æ«»èŠ±ç²‰',
      'blue': 'è—è‰²',
      'purple': 'ç´«è‰²',
      'warm': 'æš–è‰²',
      'high-contrast': 'é«˜å°æ¯”'
    };
    return themeNames[themeKey] || themeKey;
  }

  /* ===== åˆå§‹åŒ– ===== */
  function init(){
    // åˆå§‹åŒ–ä¸»é¡Œ
    const savedTheme = localStorage.getItem('selectedTheme') || 'dark';
    applyTheme(savedTheme);
    
    const savedSeats=localStorage.getItem('absentSeats'); if(savedSeats){ absentInput.value=savedSeats; }
    expectedCount=Number(localStorage.getItem('expectedCount'))||expectedCount;
    updateAbsentSeats();

    const savedCSV=localStorage.getItem('schedulesCSV');
    if(savedCSV){ try{ initialSchedules=parseCsv(savedCSV);}catch{} }
    const firstDayKey=Object.keys(initialSchedules).sort()[0];
    if(firstDayKey) loadSchedule(firstDayKey); else { renderDayButtons(); renderSchedule(); updateDisplay(); }

    setInterval(()=>{ updateDisplay(); tickClocks(); }, 1000);
    tickClocks();

    // æ§åˆ¶æ™‚é˜é¡¯ç¤º/éš±è—çš„å‡½æ•¸
    function updateClockVisibility(){
      const hud = el('clock-hud');
      const presHud = el('pres-clock');
      const clockHolder = el('clock-hud-holder');
      
      if(showClock){
        // é¡¯ç¤ºæ™‚é˜
        if(hud) hud.classList.remove('hidden');
        if(presHud) presHud.classList.remove('hidden');
        if(clockHolder) clockHolder.classList.remove('hidden');
      }else{
        // éš±è—æ™‚é˜
        if(hud) hud.classList.add('hidden');
        if(presHud) presHud.classList.add('hidden');
        if(clockHolder) clockHolder.classList.add('hidden');
      }
    }

    // æ§åˆ¶é€²åº¦æ¢é¡¯ç¤º/éš±è—çš„å‡½æ•¸
    function updateProgressVisibility(){
      const progressContainer = el('subject-progress-container');
      const presProgressContainer = el('pres-progress-container');
      
      if(showProgress){
        // é¡¯ç¤ºé€²åº¦æ¢
        if(progressContainer) progressContainer.classList.remove('hidden');
        if(presProgressContainer) presProgressContainer.classList.remove('hidden');
      }else{
        // éš±è—é€²åº¦æ¢
        if(progressContainer) progressContainer.classList.add('hidden');
        if(presProgressContainer) presProgressContainer.classList.add('hidden');
      }
    }

    // åˆå§‹åŒ–é¡¯ç¤ºæ™‚é˜é–‹é—œï¼ˆé è¨­ç‚ºé–‹å•Ÿï¼Œå³é¡¯ç¤ºæ™‚é˜ï¼‰
    if(toggleClock){
      toggleClock.checked = showClock;
      toggleClock.addEventListener('change', (e)=>{
        e.stopPropagation(); // é˜²æ­¢è§¸ç™¼ä¸‹æ‹‰é¸å–®é—œé–‰
        showClock = toggleClock.checked;
        localStorage.setItem('showClock', showClock ? 'true' : 'false');
        updateClockVisibility();
        showStatusMessage(showClock ? 'å·²é¡¯ç¤ºæ™‚é˜' : 'å·²éš±è—æ™‚é˜');
      });
      // é˜²æ­¢é»æ“Šæ»‘å‹•é–‹é—œæ™‚é—œé–‰ä¸‹æ‹‰é¸å–®
      toggleClock.addEventListener('click', (e)=>{
        e.stopPropagation();
      });
      // åˆå§‹åŒ–æ™‚é˜é¡¯ç¤ºç‹€æ…‹
      updateClockVisibility();
    }

    // åˆå§‹åŒ–é¡¯ç¤ºä¸‹èª²æ™‚é–“é–‹é—œï¼ˆé è¨­ç‚ºé—œé–‰ï¼Œå³éš±è—ä¸‹èª²æ™‚é–“ï¼‰
    if(toggleBreaks){
      toggleBreaks.checked = !hideBreaks; // toggle çš„ checked ç‹€æ…‹èˆ‡ hideBreaks ç›¸å
      toggleBreaks.addEventListener('change', (e)=>{
        e.stopPropagation(); // é˜²æ­¢è§¸ç™¼ä¸‹æ‹‰é¸å–®é—œé–‰
        hideBreaks = !toggleBreaks.checked;
        localStorage.setItem('hideBreaks', hideBreaks ? 'true' : 'false');
        renderSchedule();
        showStatusMessage(hideBreaks ? 'å·²éš±è—ä¸‹èª²æ™‚é–“' : 'å·²é¡¯ç¤ºä¸‹èª²æ™‚é–“');
      });
      // é˜²æ­¢é»æ“Šæ»‘å‹•é–‹é—œæ™‚é—œé–‰ä¸‹æ‹‰é¸å–®
      toggleBreaks.addEventListener('click', (e)=>{
        e.stopPropagation();
      });
    }

    // åˆå§‹åŒ–é¡¯ç¤ºè‡ªç¿’é–‹é—œï¼ˆé è¨­ç‚ºé—œé–‰ï¼Œå³éš±è—è‡ªç¿’ï¼‰
    if(toggleStudy){
      toggleStudy.checked = !hideStudy; // toggle çš„ checked ç‹€æ…‹èˆ‡ hideStudy ç›¸å
      toggleStudy.addEventListener('change', (e)=>{
        e.stopPropagation(); // é˜²æ­¢è§¸ç™¼ä¸‹æ‹‰é¸å–®é—œé–‰
        hideStudy = !toggleStudy.checked;
        localStorage.setItem('hideStudy', hideStudy ? 'true' : 'false');
        renderSchedule();
        showStatusMessage(hideStudy ? 'å·²éš±è—è‡ªç¿’' : 'å·²é¡¯ç¤ºè‡ªç¿’');
      });
      // é˜²æ­¢é»æ“Šæ»‘å‹•é–‹é—œæ™‚é—œé–‰ä¸‹æ‹‰é¸å–®
      toggleStudy.addEventListener('click', (e)=>{
        e.stopPropagation();
      });
    }

    // åˆå§‹åŒ–é¡¯ç¤ºé€²åº¦æ¢é–‹é—œï¼ˆé è¨­ç‚ºé–‹å•Ÿï¼Œå³é¡¯ç¤ºé€²åº¦æ¢ï¼‰
    if(toggleProgress){
      toggleProgress.checked = showProgress;
      toggleProgress.addEventListener('change', (e)=>{
        e.stopPropagation(); // é˜²æ­¢è§¸ç™¼ä¸‹æ‹‰é¸å–®é—œé–‰
        showProgress = toggleProgress.checked;
        localStorage.setItem('showProgress', showProgress ? 'true' : 'false');
        updateProgressVisibility();
        showStatusMessage(showProgress ? 'å·²é¡¯ç¤ºé€²åº¦æ¢' : 'å·²éš±è—é€²åº¦æ¢');
      });
      // é˜²æ­¢é»æ“Šæ»‘å‹•é–‹é—œæ™‚é—œé–‰ä¸‹æ‹‰é¸å–®
      toggleProgress.addEventListener('click', (e)=>{
        e.stopPropagation();
      });
      // åˆå§‹åŒ–é€²åº¦æ¢é¡¯ç¤ºç‹€æ…‹
      updateProgressVisibility();
    }

    // CSV ä¸‹æ‹‰é¸å–®åŠŸèƒ½
    if(btnCsvMenu){
      btnCsvMenu.addEventListener('click', (e)=>{
        e.stopPropagation();
        csvDropdown.classList.toggle('active');
      });
      
      // é»æ“Šå¤–éƒ¨é—œé–‰é¸å–®ï¼ˆä½†æ’é™¤æ»‘å‹•é–‹é—œå’Œä¸»é¡ŒæŒ‰éˆ•ï¼‰
      document.addEventListener('click', (e)=>{
        if(!csvDropdown.contains(e.target) && 
           !e.target.closest('.toggle-switch') && 
           !e.target.closest('.toggle-label') &&
           !e.target.closest('.theme-btn')){
          csvDropdown.classList.remove('active');
        }
      });

      // é¸å–®é …ç›®äº‹ä»¶
      if(menuImport){
        menuImport.addEventListener('click', ()=>{
          csvDropdown.classList.remove('active');
          scheduleImportModal.classList.remove('hidden');
        });
      }
      if(menuExport){
        menuExport.addEventListener('click', ()=>{
          csvDropdown.classList.remove('active');
          exportScheduleData();
        });
      }
      if(menuSample){
        menuSample.addEventListener('click', ()=>{
          csvDropdown.classList.remove('active');
          downloadSampleCsv();
        });
      }
    }

    // ä¸»é¡Œåˆ‡æ›æŒ‰éˆ•äº‹ä»¶
    document.querySelectorAll('.theme-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const themeName = btn.getAttribute('data-theme');
        if(themeName){
          applyTheme(themeName);
        }
      });
    });

    // äº‹ä»¶ç¶å®šï¼ˆåŸï¼‰
    document.getElementById('btn-close-present').addEventListener('click', closePresentation);

	btnPresent.addEventListener('click', () => {
	  const hidden = presentationOverlay().classList.contains('hidden');

	  if (hidden) {
		openPresentation();
		btnPresent.classList.add('active');
		btnPresent.setAttribute('aria-pressed', 'true');
	  } else {
		closePresentation();
		btnPresent.classList.remove('active');
		btnPresent.setAttribute('aria-pressed', 'false');
	  }
	});


    document.getElementById('btn-schedule-cancel').addEventListener('click', ()=>scheduleImportModal.classList.add('hidden'));
    document.getElementById('btn-schedule-confirm').addEventListener('click', ()=>{
      const csv=scheduleImportDataTextarea.value.trim();
      scheduleImportModal.classList.add('hidden');
      if(!csv) return showStatusMessage('æ’ç¨‹åŒ¯å…¥å–æ¶ˆæˆ–ç„¡è³‡æ–™ã€‚',true);
      try{
        const newSchedules=parseCsv(csv);
        if(!Object.keys(newSchedules).length) throw new Error('è§£æå¾Œæœªå¾—åˆ°ä»»ä½•æœ‰æ•ˆçš„æ’ç¨‹è³‡æ–™ã€‚');
        initialSchedules=newSchedules;
        const first=Object.keys(initialSchedules).sort()[0];
        loadSchedule(first);
        showStatusMessage(`æ’ç¨‹åŒ¯å…¥æˆåŠŸï¼å·²è¼‰å…¥ ${Object.keys(initialSchedules).length} å¤©æ’ç¨‹ã€‚`);
        localStorage.setItem('schedulesCSV', csv);
      }catch(e){ console.error(e); showStatusMessage(`æ’ç¨‹åŒ¯å…¥å¤±æ•—ï¼š${e.message}`,true); }
    });

    btnOpenExpected.addEventListener('click', ()=>{ el('expected-modal').classList.remove('hidden'); expectedInput.value=String(expectedCount); setTimeout(()=>expectedInput.select(),0); });
    btnExpectedCancel.addEventListener('click', ()=>el('expected-modal').classList.add('hidden'));
    btnExpectedConfirm.addEventListener('click', ()=>{
      const val=Number(expectedInput.value);
      if(!Number.isFinite(val)||val<0){ showStatusMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„äººæ•¸ï¼ˆ>= 0ï¼‰ã€‚',true); return; }
      expectedCount=Math.floor(val); localStorage.setItem('expectedCount', String(expectedCount));
      updateAbsentSeats(); el('expected-modal').classList.add('hidden'); showStatusMessage('å·²æ›´æ–°æ‡‰åˆ°äººæ•¸ã€‚');
    });
    expectedInput.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); btnExpectedConfirm.click(); } });

    btnOpenAbsent.addEventListener('click', ()=>{
      el('absent-setup-modal').classList.remove('hidden');
      const raw=localStorage.getItem('absentSeats')||(absentInput?.value||'');
      absentSetupTextarea.value=raw; setTimeout(()=>absentSetupTextarea.focus(),0);
    });
    btnAbsentSetupCancel.addEventListener('click', ()=>el('absent-setup-modal').classList.add('hidden'));
    btnAbsentSetupConfirm.addEventListener('click', ()=>{
      const raw=absentSetupTextarea.value||''; absentInput.value=raw; updateAbsentSeats();
      el('absent-setup-modal').classList.add('hidden'); showStatusMessage('å·²æ›´æ–°ç¼ºè€ƒåº§è™Ÿã€‚');
    });

    function syncFsBtn(){
      const isFs=!!document.fullscreenElement;
      btnFullscreen.setAttribute('aria-pressed', isFs?'true':'false');
      if(isFs){
        btnFullscreen.classList.add('active');
      }else{
        btnFullscreen.classList.remove('active');
      }
    }
    btnFullscreen.addEventListener('click', async ()=>{
      try{ if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); } else { await document.exitFullscreen(); } }
      catch(e){ showStatusMessage('å…¨è¢å¹•åˆ‡æ›å¤±æ•—', true); }
    });
    document.addEventListener('fullscreenchange', syncFsBtn); syncFsBtn();

    /* === éµç›¤å¿«æ·éµï¼šä¿ç•™ F / Xï¼›C åœ¨é–å®šæ™‚ç„¡æ•ˆ === */
    document.addEventListener('keydown', (e)=>{
      const tag=(e.target&&e.target.tagName)||''; const typing=['INPUT','TEXTAREA'].includes(tag)||(e.target&&e.target.isContentEditable);

      // Fï¼šå…¨è¢å¹•
      if(!typing && (e.key==='f'||e.key==='F')){
        e.preventDefault();
        try{ if(!document.fullscreenElement){ document.documentElement.requestFullscreen?.().catch(()=>{});} else { document.exitFullscreen?.().catch(()=>{});} }
        catch{ showStatusMessage('å…¨è¢å¹•åˆ‡æ›å¤±æ•—', true); }
      }

      // Xï¼šå±•ç¤ºå±¤é–‹é—œ
      if(!typing && (e.key==='x'||e.key==='X')){
        e.preventDefault();
        const hidden=presentationOverlay().classList.contains('hidden');
        hidden?openPresentation():closePresentation();
      }

      // Cï¼šæ™‚é˜é¡¯ç¤º/éš±è—ï¼ˆé–å®šæ™‚é˜»æ“‹ï¼‰
      if(!typing && (e.key==='c'||e.key==='C')){
        e.preventDefault();
        if(CLOCK_LOCKED){
          showStatusMessage('æ™‚é˜å·²é–å®š / ç„¡æ³•é¡¯ç¤ºæˆ–éš±è—');
          return;
        }
        const hud = document.getElementById('clock-hud');
        const pres = document.getElementById('pres-clock');
        hud?.classList.toggle('hidden');
        const overlayVisible = !presentationOverlay().classList.contains('hidden');
        if(overlayVisible){ pres?.classList.toggle('hidden'); }
        const isVisible = !(hud?.classList.contains('hidden'));
        try{ showStatusMessage?.(isVisible ? 'æ™‚é˜é¡¯ç¤º' : 'æ™‚é˜éš±è—'); }catch{}
      }
    });

    /* === ä¸€èˆ¬æ¨¡å¼ï¼šé–å®šæ™‚åµŒå…¥é ‚éƒ¨æ§åˆ¶åˆ—ã€ç§»é™¤æ‹–æ›³ç¸®æ”¾ === */
    {
      const hud=el('clock-hud');
      const clockHolder = el('clock-hud-holder');
      if(CLOCK_LOCKED){
        // å°‡æ™‚é˜åµŒå…¥åˆ°å°ˆç”¨çš„ clock-hud-holder å®¹å™¨ä¸­
        if(clockHolder){
          clockHolder.appendChild(hud);
        }else{
          // å¦‚æœæ‰¾ä¸åˆ° holderï¼Œå‰‡æ’å…¥åˆ°æŒ‰éˆ•å®¹å™¨çš„çˆ¶å®¹å™¨ä¸­
          const rightGroup = document.querySelector('#top-toolbar > div:last-child');
          if(rightGroup) rightGroup.appendChild(hud);
        }
        hud.classList.add('docked');
        hud.style.setProperty('--clock-scale', 1);
        // æ ¹æ“š showClock ç‹€æ…‹ä¾†é¡¯ç¤º/éš±è—æ™‚é˜
        if(!showClock){
          hud.classList.add('hidden');
        }
      }else{
        const hudCtl=makeDraggable(hud, 'hud-pos');
        restorePosition(hud, 'hud-pos', localStorage.getItem('hud-pos-corner')||'tr');
        el('hud-cycle')?.addEventListener('click', (e)=>{ e.stopPropagation(); hudCtl.cycleCorner(); });
        el('hud-reset')?.addEventListener('click', (e)=>{
          e.stopPropagation();
          localStorage.removeItem('hud-pos');
          localStorage.setItem('hud-pos-corner','tr');
          restorePosition(hud, 'hud-pos', 'tr');
        });
        applyScale(hud, 'hud-scale', 2);
        document.getElementById('hud-zoom-in')?.addEventListener('click',  (e)=>{ e.stopPropagation(); changeScale(hud, 'hud-scale',  +0.1); });
        document.getElementById('hud-zoom-out')?.addEventListener('click', (e)=>{ e.stopPropagation(); changeScale(hud, 'hud-scale',  -0.1); });
        document.getElementById('hud-zoom-reset')?.addEventListener('click',(e)=>{ e.stopPropagation(); resetScale(hud, 'hud-scale', 1); });
      }
    }

    /* === å±•ç¤ºæ¨¡å¼ï¼šé–å®šæ™‚åµŒå…¥å·¥å…·åˆ—ã€ç§»é™¤æ‹–æ›³ç¸®æ”¾ === */
    {
      const presHud=el('pres-clock');
      const toolbar=el('present-toolbar');
      if(CLOCK_LOCKED){
        toolbar.insertBefore(presHud, toolbar.lastElementChild);
        presHud.classList.add('docked');
        presHud.style.setProperty('--clock-scale', 1);
        // æ ¹æ“š showClock ç‹€æ…‹ä¾†é¡¯ç¤º/éš±è—æ™‚é˜
        if(!showClock){
          presHud.classList.add('hidden');
        }
      }else{
        const presCtl=makeDraggable(presHud, 'pres-hud-pos');
        restorePosition(presHud, 'pres-hud-pos', localStorage.getItem('pres-hud-pos-corner')||'tr');
        el('pres-cycle')?.addEventListener('click', (e)=>{ e.stopPropagation(); presCtl.cycleCorner(); });
        applyScale(presHud, 'pres-scale', 2);
        document.getElementById('pres-zoom-in')?.addEventListener('click',   (e)=>{ e.stopPropagation(); changeScale(presHud, 'pres-scale',  +0.1); });
        document.getElementById('pres-zoom-out')?.addEventListener('click',  (e)=>{ e.stopPropagation(); changeScale(presHud, 'pres-scale',  -0.1); });
      }
    }

    // ç¢ºä¿æ™‚é˜é¡¯ç¤ºç‹€æ…‹æ­£ç¢ºæ‡‰ç”¨ï¼ˆåœ¨æ‰€æœ‰åˆå§‹åŒ–å®Œæˆå¾Œï¼‰
    if(typeof updateClockVisibility === 'function'){
      updateClockVisibility();
    }
    // ç¢ºä¿é€²åº¦æ¢é¡¯ç¤ºç‹€æ…‹æ­£ç¢ºæ‡‰ç”¨ï¼ˆåœ¨æ‰€æœ‰åˆå§‹åŒ–å®Œæˆå¾Œï¼‰
    if(typeof updateProgressVisibility === 'function'){
      updateProgressVisibility();
    }

  }
</script>
</body>
</html>




<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>互動問答牆 | EduTV Tools</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg-1: #120414;
        --bg-2: #210627;
        --bg-3: #360f3d;
        --card-bg: rgba(255, 167, 255, 0.08);
        --card-border: rgba(255, 167, 255, 0.32);
        --accent: #fb7185;
        --accent-strong: #f97316;
        --accent-alt: #a855f7;
        --text-main: #fff7ff;
        --text-muted: rgba(255, 240, 255, 0.76);
        --shadow: 0 28px 60px rgba(38, 1, 43, 0.6);
        font-family: "Segoe UI", "Noto Sans TC", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: clamp(1.5rem, 4vw, 3.5rem);
        background:
          radial-gradient(circle at top right, rgba(249, 115, 22, 0.3), transparent 50%),
          radial-gradient(circle at bottom left, rgba(168, 85, 247, 0.25), transparent 40%),
          linear-gradient(145deg, var(--bg-1), var(--bg-2) 55%, var(--bg-3));
        color: var(--text-main);
      }

      main {
        width: min(1200px, 100%);
        display: grid;
        gap: clamp(1.5rem, 3.2vw, 2.5rem);
      }

      header {
        text-align: center;
      }

      header h1 {
        margin: 0;
        font-size: clamp(2.4rem, 4.5vw, 3.6rem);
        letter-spacing: 0.14em;
      }

      header p {
        margin-top: 0.6rem;
        font-size: clamp(1rem, 2.3vw, 1.3rem);
        color: var(--text-muted);
      }

      .layout {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        gap: clamp(1.4rem, 2.8vw, 2.2rem);
      }

      section.card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 26px;
        padding: clamp(1.9rem, 3.2vw, 2.5rem);
        box-shadow: var(--shadow);
        backdrop-filter: blur(20px);
      }

      section.card h2 {
        margin: 0 0 1.1rem;
        font-size: clamp(1.6rem, 3vw, 2rem);
        letter-spacing: 0.08em;
      }

      form {
        display: grid;
        gap: 1rem;
      }

      label span {
        display: block;
        margin-bottom: 0.35rem;
        font-weight: 600;
        color: var(--text-muted);
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 14px;
        border: 1px solid rgba(255, 208, 255, 0.35);
        background: rgba(50, 14, 58, 0.55);
        color: inherit;
        font: inherit;
      }

      textarea {
        resize: vertical;
        min-height: 110px;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: 2px solid rgba(249, 115, 22, 0.35);
        outline-offset: 2px;
      }

      .options-list {
        display: grid;
        gap: 0.8rem;
      }

      .options-list .option-row {
        display: flex;
        gap: 0.6rem;
        align-items: center;
      }

      .options-list input[type="text"] {
        flex: 1;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 0.85rem 1.7rem;
        font: inherit;
        font-weight: 600;
        letter-spacing: 0.06em;
        cursor: pointer;
        transition: transform 180ms ease, box-shadow 180ms ease;
      }

      button.primary {
        background: linear-gradient(135deg, var(--accent), var(--accent-strong));
        color: #330101;
      }

      button.secondary {
        background: rgba(255, 208, 255, 0.16);
        color: var(--text-main);
      }

      button.warning {
        background: linear-gradient(135deg, #fbbf24, #f97316);
        color: #2b1400;
      }

      button.alt {
        background: linear-gradient(135deg, var(--accent-alt), #6366f1);
        color: #10002b;
      }

      button.icon {
        padding: 0.6rem 0.9rem;
        border-radius: 14px;
        font-size: 1rem;
      }

      button:hover,
      button:focus-visible {
        transform: translateY(-2px);
        box-shadow: 0 12px 26px rgba(249, 115, 22, 0.25);
      }

      .question-display {
        margin-bottom: 1.4rem;
        display: grid;
        gap: 0.4rem;
      }

      .question-display h3 {
        margin: 0;
        font-size: clamp(1.6rem, 3vw, 2.2rem);
      }

      .question-type {
        font-size: 0.95rem;
        color: rgba(255, 240, 255, 0.7);
      }

      .chart {
        display: grid;
        gap: 0.8rem;
      }

      .bar-row {
        display: grid;
        gap: 0.5rem;
      }

      .bar-label {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.6rem;
        font-size: 1.05rem;
      }

      .bar-track {
        width: 100%;
        height: 18px;
        border-radius: 999px;
        background: rgba(255, 167, 255, 0.16);
        overflow: hidden;
      }

      .bar-fill {
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, var(--accent), var(--accent-strong));
        transition: width 180ms ease;
      }

      .bar-actions {
        display: flex;
        gap: 0.6rem;
      }

      .response-list {
        display: grid;
        gap: 0.75rem;
        max-height: 320px;
        overflow-y: auto;
        padding-right: 0.3rem;
      }

      .response-item {
        padding: 0.85rem 1rem;
        border-radius: 16px;
        background: rgba(168, 85, 247, 0.16);
        border: 1px solid rgba(168, 85, 247, 0.35);
        line-height: 1.5;
      }

      .response-item.highlight {
        border-color: rgba(249, 115, 22, 0.6);
        box-shadow: 0 0 18px rgba(249, 115, 22, 0.25);
      }

      .empty-state {
        text-align: center;
        padding: 1.6rem;
        border-radius: 18px;
        background: rgba(60, 12, 72, 0.28);
        border: 1px dashed rgba(255, 208, 255, 0.28);
        color: rgba(255, 240, 255, 0.65);
        font-size: 1.05rem;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.7rem;
      }

      @media (max-width: 720px) {
        .controls button {
          flex: 1 1 100%;
        }
        .bar-actions {
          flex-wrap: wrap;
        }
        .bar-actions button {
          flex: 1 1 auto;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>互動問答牆</h1>
        <p>即時投票與簡答結果一目瞭然，協助老師掌握課堂節奏與學習回饋。</p>
      </header>
      <div class="layout">
        <section class="card">
          <h2>設定問答</h2>
          <form id="pollForm">
            <label>
              <span>問題內容</span>
              <input type="text" id="questionInput" placeholder="今天的課堂重點是什麼？" required />
            </label>
            <label>
              <span>答案型態</span>
              <select id="typeSelect">
                <option value="choice">選擇題 / 投票</option>
                <option value="open">簡答題 / 想法牆</option>
              </select>
            </label>
            <div id="choiceArea">
              <span style="font-weight:600;color:var(--text-muted)">選項設定</span>
              <div class="options-list" id="optionsList"></div>
              <button type="button" class="secondary icon" id="addOptionBtn">＋ 新增選項</button>
            </div>
            <div class="controls">
              <button type="submit" class="primary">更新問題</button>
              <button type="button" id="resetBtn" class="warning">清空結果</button>
              <button type="button" id="demoBtn" class="secondary">載入示範</button>
            </div>
          </form>
        </section>
        <section class="card">
          <h2>即時結果</h2>
          <div id="resultArea">
            <div class="empty-state">請先設定問題，結果會即時顯示於此。</div>
          </div>
        </section>
      </div>
    </main>
    <script>
      (() => {
        const pollForm = document.getElementById("pollForm");
        const questionInput = document.getElementById("questionInput");
        const typeSelect = document.getElementById("typeSelect");
        const optionsList = document.getElementById("optionsList");
        const addOptionBtn = document.getElementById("addOptionBtn");
        const resultArea = document.getElementById("resultArea");
        const resetBtn = document.getElementById("resetBtn");
        const demoBtn = document.getElementById("demoBtn");

        let pollData = {
          question: "",
          type: "choice",
          options: [],
          responses: [],
        };

        function createOptionRow(value = "") {
          const row = document.createElement("div");
          row.className = "option-row";
          row.innerHTML = `
            <input type="text" placeholder="新增選項" value="${value}" required />
            <button type="button" class="icon secondary">－</button>
          `;
          const input = row.querySelector("input");
          const removeBtn = row.querySelector("button");
          removeBtn.addEventListener("click", () => {
            if (optionsList.children.length > 1) {
              row.remove();
            } else {
              input.value = "";
              input.focus();
            }
          });
          return row;
        }

        function ensureOptionRows() {
          if (!optionsList.children.length) {
            optionsList.appendChild(createOptionRow("選項 A"));
            optionsList.appendChild(createOptionRow("選項 B"));
          }
        }

        function getOptionValues() {
          return Array.from(optionsList.querySelectorAll("input"))
            .map((input) => input.value.trim())
            .filter(Boolean);
        }

        function renderChoiceResults() {
          const totalVotes = pollData.options.reduce((acc, option) => acc + option.count, 0);
          const questionHtml = `
            <div class="question-display">
              <h3>${pollData.question}</h3>
              <div class="question-type">投票題｜目前統計 ${totalVotes} 票</div>
            </div>
          `;

          const bars = pollData.options
            .map((option, index) => {
              const percent = totalVotes > 0 ? Math.round((option.count / totalVotes) * 100) : 0;
              return `
              <div class="bar-row" data-index="${index}">
                <div class="bar-label">
                  <strong>${option.label}</strong>
                  <span>${option.count} 票｜${percent}%</span>
                </div>
                <div class="bar-track">
                  <div class="bar-fill" style="width:${percent}%"></div>
                </div>
                <div class="bar-actions">
                  <button type="button" class="primary icon" data-action="plus" data-index="${index}">＋1</button>
                  <button type="button" class="secondary icon" data-action="minus" data-index="${index}">－1</button>
                  <button type="button" class="alt icon" data-action="add5" data-index="${index}">＋5</button>
                </div>
              </div>
            `;
            })
            .join("");

          resultArea.innerHTML = `
            ${questionHtml}
            <div class="chart">${bars}</div>
          `;
        }

        function renderOpenResults() {
          const questionHtml = `
            <div class="question-display">
              <h3>${pollData.question}</h3>
              <div class="question-type">簡答題｜已收集 ${pollData.responses.length} 則回覆</div>
            </div>
          `;

          const responsesHtml = pollData.responses.length
            ? pollData.responses
                .map(
                  (response, idx) => `
                  <div class="response-item" data-index="${idx}">
                    ${response.text.replace(/</g, "&lt;").replace(/>/g, "&gt;")}
                  </div>
                `
                )
                .join("")
            : '<div class="empty-state">尚未新增任何簡答回覆，可輸入後加入。</div>';

          resultArea.innerHTML = `
            ${questionHtml}
            <div class="controls" style="margin-bottom:1rem">
              <input type="text" id="responseInput" placeholder="輸入學生回覆後加入列表……" />
              <button type="button" class="primary" id="addResponseBtn">加入回覆</button>
              <button type="button" class="secondary" id="highlightBtn">隨機亮點</button>
            </div>
            <div class="response-list" id="responseList">${responsesHtml}</div>
          `;
        }

        function render() {
          if (!pollData.question) {
            resultArea.innerHTML = '<div class="empty-state">請先設定問題，結果會即時顯示於此。</div>';
            return;
          }
          if (pollData.type === "choice") {
            renderChoiceResults();
          } else {
            renderOpenResults();
          }
        }

        pollForm.addEventListener("submit", (event) => {
          event.preventDefault();
          const question = questionInput.value.trim();
          if (!question) {
            alert("請輸入問題內容。");
            return;
          }
          const type = typeSelect.value;
          if (type === "choice") {
            const optionValues = getOptionValues();
            if (optionValues.length < 2) {
              alert("請至少保留兩個選項。");
              return;
            }
            pollData = {
              question,
              type,
              options: optionValues.map((label, index) => ({
                label,
                count: pollData.options[index]?.count ?? 0,
              })),
              responses: [],
            };
          } else {
            pollData = {
              question,
              type,
              options: [],
              responses: pollData.type === "open" ? pollData.responses : [],
            };
          }
          render();
        });

        addOptionBtn.addEventListener("click", () => {
          optionsList.appendChild(createOptionRow());
          optionsList.lastElementChild.querySelector("input").focus();
        });

        typeSelect.addEventListener("change", () => {
          document.getElementById("choiceArea").style.display = typeSelect.value === "choice" ? "block" : "none";
        });

        resultArea.addEventListener("click", (event) => {
          const button = event.target.closest("button");
          if (!button || pollData.type !== "choice") return;
          const index = Number(button.dataset.index);
          if (Number.isNaN(index)) return;
          const action = button.dataset.action;
          if (action === "plus") {
            pollData.options[index].count += 1;
          } else if (action === "add5") {
            pollData.options[index].count += 5;
          } else if (action === "minus" && pollData.options[index].count > 0) {
            pollData.options[index].count -= 1;
          }
          render();
        });

        resultArea.addEventListener("click", (event) => {
          if (pollData.type !== "open") return;
          const target = event.target;
          if (target.id === "addResponseBtn") {
            const input = document.getElementById("responseInput");
            const text = input.value.trim();
            if (!text) {
              alert("請輸入回覆內容。");
              return;
            }
            pollData.responses.unshift({ text });
            input.value = "";
            renderOpenResults();
            document.getElementById("responseInput").focus();
          } else if (target.id === "highlightBtn") {
            if (!pollData.responses.length) return;
            const list = document.getElementById("responseList");
            list.querySelectorAll(".response-item").forEach((item) => item.classList.remove("highlight"));
            const randomIndex = Math.floor(Math.random() * pollData.responses.length);
            const highlightItem = list.querySelector(`[data-index="${randomIndex}"]`);
            if (highlightItem) {
              highlightItem.classList.add("highlight");
              highlightItem.scrollIntoView({ behavior: "smooth", block: "center" });
            }
          }
        });

        resetBtn.addEventListener("click", () => {
          pollData = { question: "", type: "choice", options: [], responses: [] };
          questionInput.value = "";
          typeSelect.value = "choice";
          optionsList.innerHTML = "";
          ensureOptionRows();
          render();
        });

        demoBtn.addEventListener("click", () => {
          questionInput.value = "今天最想深入練習哪一個學習策略？";
          typeSelect.value = "choice";
          document.getElementById("choiceArea").style.display = "block";
          optionsList.innerHTML = "";
          ["SQ3R 閱讀法", "思考導圖", "同儕教學", "自我測驗"].forEach((label) => optionsList.appendChild(createOptionRow(label)));
          pollData = {
            question: questionInput.value,
            type: "choice",
            options: [
              { label: "SQ3R 閱讀法", count: 12 },
              { label: "思考導圖", count: 8 },
              { label: "同儕教學", count: 5 },
              { label: "自我測驗", count: 15 },
            ],
            responses: [],
          };
          render();
        });

        ensureOptionRows();
        render();
      })();
    </script>
  </body>
</html>

